"use strict";exports.__esModule=!0,exports.default=exports.Select=void 0;var _styledBase=_interopRequireDefault(require("@emotion/styled-base")),_react=_interopRequireWildcard(require("react")),_reactDom=_interopRequireDefault(require("react-dom")),_propTypes=_interopRequireDefault(require("prop-types")),_ClickOutside=_interopRequireDefault(require("./components/ClickOutside")),_Content=_interopRequireDefault(require("./components/Content")),_Dropdown=_interopRequireDefault(require("./components/Dropdown")),_Loading=_interopRequireDefault(require("./components/Loading")),_Clear=_interopRequireDefault(require("./components/Clear")),_Separator=_interopRequireDefault(require("./components/Separator")),_DropdownHandle=_interopRequireDefault(require("./components/DropdownHandle")),_util=require("./util"),_constants=require("./constants");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;return _getRequireWildcardCache=function(){return a},a}function _interopRequireWildcard(a){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var b=_getRequireWildcardCache();if(b&&b.has(a))return b.get(a);var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;f&&(f.get||f.set)?Object.defineProperty(c,e,f):c[e]=a[e]}return c.default=a,b&&b.set(a,c),c}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var Select=/*#__PURE__*/function(a){function b(b){var c;return c=a.call(this,b)||this,_defineProperty(_assertThisInitialized(c),"onDropdownClose",function(){c.setState({cursor:null}),c.props.onDropdownClose()}),_defineProperty(_assertThisInitialized(c),"onScroll",function(){c.props.closeOnScroll&&c.dropDown("close"),c.updateSelectBounds()}),_defineProperty(_assertThisInitialized(c),"updateSelectBounds",function(){return c.select.current&&c.setState({selectBounds:c.select.current.getBoundingClientRect()})}),_defineProperty(_assertThisInitialized(c),"getSelectBounds",function(){return c.state.selectBounds}),_defineProperty(_assertThisInitialized(c),"dropDown",function(a,b){void 0===a&&(a="toggle");var d=b&&b.target||b&&b.srcElement;return c.props.portal&&!c.props.closeOnScroll&&!c.props.closeOnSelect&&b&&d&&d.offsetParent&&d.offsetParent.classList.contains("react-dropdown-select-dropdown")?void 0:c.props.keepOpen?c.setState({dropdown:!0}):"close"===a&&c.state.dropdown?(c.select.current.blur(),c.setState({dropdown:!1,search:c.props.clearOnBlur?"":c.state.search})):"open"!==a||c.state.dropdown?"toggle"===a&&(c.select.current.focus(),c.setState({dropdown:!c.state.dropdown})):c.setState({dropdown:!0})}),_defineProperty(_assertThisInitialized(c),"getSelectRef",function(){return c.select.current}),_defineProperty(_assertThisInitialized(c),"addItem",function(a){if(c.props.multi){if((0,_util.valueExistInSelected)((0,_util.getByPath)(a,c.props.valueField),c.state.values,c.props))return c.removeItem(null,a,!1);c.setState({values:[].concat(c.state.values,[a])})}else c.setState({values:[a],dropdown:!1});return c.props.clearOnSelect&&c.setState({search:""}),!0}),_defineProperty(_assertThisInitialized(c),"removeItem",function(a,b,d){void 0===d&&(d=!1),a&&d&&(a.preventDefault(),a.stopPropagation(),c.dropDown("close")),c.setState({values:c.state.values.filter(function(a){return(0,_util.getByPath)(a,c.props.valueField)!==(0,_util.getByPath)(b,c.props.valueField)})})}),_defineProperty(_assertThisInitialized(c),"setSearch",function(a){c.setState({cursor:null}),c.setState({search:a.target.value})}),_defineProperty(_assertThisInitialized(c),"getInputSize",function(){return c.state.search?c.state.search.length:0<c.state.values.length?c.props.addPlaceholder.length:c.props.placeholder.length}),_defineProperty(_assertThisInitialized(c),"toggleSelectAll",function(){return c.setState({values:0===c.state.values.length?c.selectAll():c.clearAll()})}),_defineProperty(_assertThisInitialized(c),"clearAll",function(){c.props.onClearAll(),c.setState({values:[]})}),_defineProperty(_assertThisInitialized(c),"selectAll",function(a){void 0===a&&(a=[]),c.props.onSelectAll();var b=0<a.length?a:c.props.options.filter(function(a){return!a.disabled});c.setState({values:b})}),_defineProperty(_assertThisInitialized(c),"isSelected",function(a){return!!c.state.values.find(function(b){return(0,_util.getByPath)(b,c.props.valueField)===(0,_util.getByPath)(a,c.props.valueField)})}),_defineProperty(_assertThisInitialized(c),"areAllSelected",function(){return c.state.values.length===c.props.options.filter(function(a){return!a.disabled}).length}),_defineProperty(_assertThisInitialized(c),"safeString",function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}),_defineProperty(_assertThisInitialized(c),"sortBy",function(){var a=c.props,d=a.sortBy,e=a.options;return d?(e.sort(function(c,a){return(0,_util.getProp)(c,d)<(0,_util.getProp)(a,d)?-1:(0,_util.getProp)(c,d)>(0,_util.getProp)(a,d)?1:0}),e):e}),_defineProperty(_assertThisInitialized(c),"searchFn",function(a){var b=a.state,d=a.methods,e=new RegExp(d.safeString(b.search),"i");return d.sortBy().filter(function(a){return e.test((0,_util.getByPath)(a,c.props.searchBy)||(0,_util.getByPath)(a,c.props.valueField))})}),_defineProperty(_assertThisInitialized(c),"searchResults",function(){var a={state:c.state,props:c.props,methods:c.methods};return c.props.searchFn(a)||c.searchFn(a)}),_defineProperty(_assertThisInitialized(c),"activeCursorItem",function(a){return c.setState({activeCursorItem:a})}),_defineProperty(_assertThisInitialized(c),"handleKeyDown",function(a){var b={event:a,state:c.state,props:c.props,methods:c.methods,setState:c.setState.bind(_assertThisInitialized(c))};return c.props.handleKeyDownFn(b)||c.handleKeyDownFn(b)}),_defineProperty(_assertThisInitialized(c),"handleKeyDownFn",function(a){var b=a.event,d=a.state,e=a.props,f=a.methods,g=a.setState,h=d.cursor,i="Escape"===b.key,j="Enter"===b.key,k="ArrowUp"===b.key,l="ArrowDown"===b.key,m="Backspace"===b.key,n="Tab"===b.key&&!b.shiftKey,o=b.shiftKey&&"Tab"===b.key;if((l||n)&&null===h)return g({cursor:0});if((k||l||o||n)&&b.preventDefault(),i&&c.dropDown("close"),j){var p=f.searchResults()[h];if(p&&!p.disabled){if(e.create&&(0,_util.valueExistInSelected)(d.search,d.values,e))return null;f.addItem(p)}}return(l||n)&&f.searchResults().length===h?g({cursor:0}):void((l||n)&&g(function(a){return{cursor:a.cursor+1}}),(k||o)&&0<h&&g(function(a){return{cursor:a.cursor-1}}),(k||o)&&0===h&&g({cursor:f.searchResults().length}),m&&e.multi&&e.backspaceDelete&&0===c.getInputSize()&&c.setState({values:c.state.values.slice(0,-1)}))}),_defineProperty(_assertThisInitialized(c),"renderDropdown",function(){return c.props.portal?_reactDom.default.createPortal(_react.default.createElement(_Dropdown.default,{props:c.props,state:c.state,methods:c.methods}),c.dropdownRoot):_react.default.createElement(_Dropdown.default,{props:c.props,state:c.state,methods:c.methods})}),_defineProperty(_assertThisInitialized(c),"createNew",function(a){var b,d=(b={},b[c.props.labelField]=a,b[c.props.valueField]=a,b);c.addItem(d),c.props.onCreateNew(d),c.setState({search:""})}),c.state={dropdown:!1,values:b.values,search:"",selectBounds:{},cursor:null},c.methods={removeItem:c.removeItem,dropDown:c.dropDown,addItem:c.addItem,setSearch:c.setSearch,getInputSize:c.getInputSize,toggleSelectAll:c.toggleSelectAll,clearAll:c.clearAll,selectAll:c.selectAll,searchResults:c.searchResults,getSelectRef:c.getSelectRef,isSelected:c.isSelected,getSelectBounds:c.getSelectBounds,areAllSelected:c.areAllSelected,handleKeyDown:c.handleKeyDown,activeCursorItem:c.activeCursorItem,createNew:c.createNew,sortBy:c.sortBy,safeString:c.safeString},c.select=_react.default.createRef(),c.dropdownRoot="undefined"!=typeof document&&document.createElement("div"),c}_inheritsLoose(b,a);var c=b.prototype;return c.componentDidMount=function componentDidMount(){this.props.portal&&this.props.portal.appendChild(this.dropdownRoot),(0,_util.isomorphicWindow)().addEventListener("resize",(0,_util.debounce)(this.updateSelectBounds)),this.props.scrollContainer?this.props.scrollContainer.addEventListener("scroll",(0,_util.debounce)(this.onScroll)):(0,_util.isomorphicWindow)().addEventListener("scroll",(0,_util.debounce)(this.onScroll)),this.dropDown("close"),this.select&&this.updateSelectBounds()},c.componentDidUpdate=function componentDidUpdate(a,b){var c=this;!(0,_util.isEqual)(a.values,this.props.values)&&(0,_util.isEqual)(a.values,b.values)&&(this.setState({values:this.props.values},function(){c.props.onChange(c.state.values)}),this.updateSelectBounds()),b.values!==this.state.values&&(this.props.onChange(this.state.values),this.updateSelectBounds()),b.search!==this.state.search&&this.updateSelectBounds(),b.values!==this.state.values&&this.props.closeOnSelect&&this.dropDown("close"),a.multi!==this.props.multi&&this.updateSelectBounds(),b.dropdown&&b.dropdown!==this.state.dropdown&&this.onDropdownClose(),b.dropdown||b.dropdown===this.state.dropdown||(this.updateSelectBounds(),this.props.onDropdownOpen()),this.props.portal&&a.portal!==this.props.portal&&this.props.portal&&this.props.portal.appendChild(this.dropdownRoot),!this.props.portal&&a.portal!==this.props.portal&&this.props.portal&&this.props.portal.removeChild(this.dropdownRoot),this.props.scrollContainer&&a.scrollContainer!==this.props.scrollContainer&&(this.props.scrollContainer.addEventListener("scroll",(0,_util.debounce)(this.onScroll)),(0,_util.isomorphicWindow)().removeEventListener("scroll",(0,_util.debounce)(this.onScroll,this.props.debounceDelay))),this.props.scrollContainer||a.scrollContainer===this.props.scrollContainer||(this.props.scrollContainer.removeEventListener("scroll",(0,_util.debounce)(this.onScroll)),(0,_util.isomorphicWindow)().addEventListener("scroll",(0,_util.debounce)(this.onScroll)))},c.componentWillUnmount=function componentWillUnmount(){this.props.portal&&this.props.portal.removeChild(this.dropdownRoot),(0,_util.isomorphicWindow)().removeEventListener("resize",(0,_util.debounce)(this.updateSelectBounds,this.props.debounceDelay)),this.props.scrollContainer?this.props.scrollContainer.removeEventListener("scroll",(0,_util.debounce)(this.onScroll,this.props.debounceDelay)):(0,_util.isomorphicWindow)().removeEventListener("scroll",(0,_util.debounce)(this.onScroll,this.props.debounceDelay))},c.render=function render(){var a=this;return _react.default.createElement(_ClickOutside.default,{onClickOutside:function onClickOutside(b){return a.dropDown("close",b)}},_react.default.createElement(ReactDropdownSelect,_extends({onKeyDown:this.handleKeyDown,onClick:function onClick(b){return a.dropDown(a.props.toggleOnOpen?"toggle":"open",b)},onFocus:function onFocus(b){return a.dropDown("open",b)},tabIndex:this.props.disabled?"-1":"0",direction:this.props.direction,style:this.props.style,ref:this.select,disabled:this.props.disabled,className:_constants.LIB_NAME+" "+this.props.className,color:this.props.color},this.props.additionalProps),_react.default.createElement(_Content.default,{props:this.props,state:this.state,methods:this.methods}),(this.props.name||this.props.required)&&_react.default.createElement("input",{tabIndex:-1,style:{opacity:0,width:0,position:"absolute"},name:this.props.name,required:this.props.required,pattern:this.props.pattern,value:this.state.values.map(function(b){return b[a.props.labelField]}).toString()||[],disabled:this.props.disabled}),this.props.loading&&_react.default.createElement(_Loading.default,{props:this.props}),this.props.clearable&&_react.default.createElement(_Clear.default,{props:this.props,state:this.state,methods:this.methods}),this.props.separator&&_react.default.createElement(_Separator.default,{props:this.props,state:this.state,methods:this.methods}),this.props.dropdownHandle&&_react.default.createElement(_DropdownHandle.default,{onClick:function onClick(){return a.select.current.focus()},props:this.props,state:this.state,methods:this.methods}),this.state.dropdown&&!this.props.disabled&&this.renderDropdown()))},b}(_react.Component);exports.Select=Select,Select.defaultProps={addPlaceholder:"",placeholder:"Select...",values:[],options:[],multi:!1,disabled:!1,searchBy:"label",sortBy:null,clearable:!1,searchable:!0,dropdownHandle:!0,separator:!1,keepOpen:void 0,noDataLabel:"No data",createNewLabel:"add {search}",disabledLabel:"disabled",dropdownGap:5,closeOnScroll:!1,debounceDelay:0,labelField:"label",valueField:"value",color:"#0074D9",keepSelectedInList:!0,closeOnSelect:!1,clearOnBlur:!0,clearOnSelect:!0,dropdownPosition:"bottom",dropdownHeight:"300px",autoFocus:!1,portal:null,create:!1,direction:"ltr",name:null,required:!1,pattern:!1,onChange:function onChange(){},onDropdownOpen:function onDropdownOpen(){},onDropdownClose:function onDropdownClose(){},onClearAll:function onClearAll(){},onSelectAll:function onSelectAll(){},onCreateNew:function onCreateNew(){},searchFn:function searchFn(){},handleKeyDownFn:function handleKeyDownFn(){},additionalProps:null,backspaceDelete:!0};var ReactDropdownSelect=(0,_styledBase.default)("div",{target:"e1gzf2xs0",label:"ReactDropdownSelect"})("position:relative;display:flex;border:1px solid #ccc;width:100%;border-radius:2px;padding:2px 5px;flex-direction:row;direction:",function(a){var b=a.direction;return b},";align-items:center;cursor:pointer;min-height:36px;",function(a){var b=a.disabled;return b?"cursor: not-allowed;pointer-events: none;opacity: 0.3;":"pointer-events: all;"},":hover,:focus-within{border-color:",function(a){var b=a.color;return b},";}:focus,:focus-within{outline:0;box-shadow:0 0 0 3px ",function(a){var b=a.color;return(0,_util.hexToRGBA)(b,.2)},";}"+("production"===process.env.NODE_ENV?"":"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFpbEJzQyIsImZpbGUiOiIuLi9zcmMvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcclxuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcclxuaW1wb3J0IHN0eWxlZCBmcm9tICdAZW1vdGlvbi9zdHlsZWQnO1xyXG5pbXBvcnQgQ2xpY2tPdXRzaWRlIGZyb20gJy4vY29tcG9uZW50cy9DbGlja091dHNpZGUnO1xyXG5cclxuaW1wb3J0IENvbnRlbnQgZnJvbSAnLi9jb21wb25lbnRzL0NvbnRlbnQnO1xyXG5pbXBvcnQgRHJvcGRvd24gZnJvbSAnLi9jb21wb25lbnRzL0Ryb3Bkb3duJztcclxuaW1wb3J0IExvYWRpbmcgZnJvbSAnLi9jb21wb25lbnRzL0xvYWRpbmcnO1xyXG5pbXBvcnQgQ2xlYXIgZnJvbSAnLi9jb21wb25lbnRzL0NsZWFyJztcclxuaW1wb3J0IFNlcGFyYXRvciBmcm9tICcuL2NvbXBvbmVudHMvU2VwYXJhdG9yJztcclxuaW1wb3J0IERyb3Bkb3duSGFuZGxlIGZyb20gJy4vY29tcG9uZW50cy9Ecm9wZG93bkhhbmRsZSc7XHJcblxyXG5pbXBvcnQgeyBkZWJvdW5jZSwgaGV4VG9SR0JBLCBpc0VxdWFsLCBnZXRCeVBhdGgsIGdldFByb3AsIHZhbHVlRXhpc3RJblNlbGVjdGVkLCBpc29tb3JwaGljV2luZG93IH0gZnJvbSAnLi91dGlsJztcclxuaW1wb3J0IHsgTElCX05BTUUgfSBmcm9tICcuL2NvbnN0YW50cyc7XHJcblxyXG5leHBvcnQgY2xhc3MgU2VsZWN0IGV4dGVuZHMgQ29tcG9uZW50IHtcclxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xyXG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXHJcbiAgICBvbkRyb3Bkb3duQ2xvc2U6IFByb3BUeXBlcy5mdW5jLFxyXG4gICAgb25Ecm9wZG93bk9wZW46IFByb3BUeXBlcy5mdW5jLFxyXG4gICAgb25DbGVhckFsbDogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBvblNlbGVjdEFsbDogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICB2YWx1ZXM6IFByb3BUeXBlcy5hcnJheSxcclxuICAgIG9wdGlvbnM6IFByb3BUeXBlcy5hcnJheS5pc1JlcXVpcmVkLFxyXG4gICAga2VlcE9wZW46IFByb3BUeXBlcy5ib29sLFxyXG4gICAgZHJvcGRvd25HYXA6IFByb3BUeXBlcy5udW1iZXIsXHJcbiAgICBtdWx0aTogUHJvcFR5cGVzLmJvb2wsXHJcbiAgICBwbGFjZWhvbGRlcjogUHJvcFR5cGVzLnN0cmluZyxcclxuICAgIGFkZFBsYWNlaG9sZGVyOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gICAgbG9hZGluZzogUHJvcFR5cGVzLmJvb2wsXHJcbiAgICBjbGVhcmFibGU6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgc2VhcmNoYWJsZTogUHJvcFR5cGVzLmJvb2wsXHJcbiAgICBzZXBhcmF0b3I6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgZHJvcGRvd25IYW5kbGU6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgc2VhcmNoQnk6IFByb3BUeXBlcy5zdHJpbmcsXHJcbiAgICBzb3J0Qnk6IFByb3BUeXBlcy5zdHJpbmcsXHJcbiAgICBjbG9zZU9uU2Nyb2xsOiBQcm9wVHlwZXMuYm9vbCxcclxuICAgIG9wZW5PblRvcDogUHJvcFR5cGVzLmJvb2wsXHJcbiAgICBzdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcclxuICAgIGNvbnRlbnRSZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBkcm9wZG93blJlbmRlcmVyOiBQcm9wVHlwZXMuZnVuYyxcclxuICAgIGl0ZW1SZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBub0RhdGFSZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBvcHRpb25SZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBpbnB1dFJlbmRlcmVyOiBQcm9wVHlwZXMuZnVuYyxcclxuICAgIGxvYWRpbmdSZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBjbGVhclJlbmRlcmVyOiBQcm9wVHlwZXMuZnVuYyxcclxuICAgIHNlcGFyYXRvclJlbmRlcmVyOiBQcm9wVHlwZXMuZnVuYyxcclxuICAgIGRyb3Bkb3duSGFuZGxlUmVuZGVyZXI6IFByb3BUeXBlcy5mdW5jLFxyXG4gICAgZGlyZWN0aW9uOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gICAgcmVxdWlyZWQ6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgcGF0dGVybjogUHJvcFR5cGVzLnN0cmluZyxcclxuICAgIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXHJcbiAgICBiYWNrc3BhY2VEZWxldGU6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgdG9nZ2xlT25PcGVuOiBQcm9wVHlwZXMuYm9vbFxyXG4gICAgLy8gb3BlbjogUHJvcFR5cGVzLmJvb2xcclxuICB9O1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG5cclxuICAgIHRoaXMuc3RhdGUgPSB7XHJcbiAgICAgIGRyb3Bkb3duOiBmYWxzZSxcclxuICAgICAgdmFsdWVzOiBwcm9wcy52YWx1ZXMsXHJcbiAgICAgIHNlYXJjaDogJycsXHJcbiAgICAgIHNlbGVjdEJvdW5kczoge30sXHJcbiAgICAgIGN1cnNvcjogbnVsbFxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLm1ldGhvZHMgPSB7XHJcbiAgICAgIHJlbW92ZUl0ZW06IHRoaXMucmVtb3ZlSXRlbSxcclxuICAgICAgZHJvcERvd246IHRoaXMuZHJvcERvd24sXHJcbiAgICAgIGFkZEl0ZW06IHRoaXMuYWRkSXRlbSxcclxuICAgICAgc2V0U2VhcmNoOiB0aGlzLnNldFNlYXJjaCxcclxuICAgICAgZ2V0SW5wdXRTaXplOiB0aGlzLmdldElucHV0U2l6ZSxcclxuICAgICAgdG9nZ2xlU2VsZWN0QWxsOiB0aGlzLnRvZ2dsZVNlbGVjdEFsbCxcclxuICAgICAgY2xlYXJBbGw6IHRoaXMuY2xlYXJBbGwsXHJcbiAgICAgIHNlbGVjdEFsbDogdGhpcy5zZWxlY3RBbGwsXHJcbiAgICAgIHNlYXJjaFJlc3VsdHM6IHRoaXMuc2VhcmNoUmVzdWx0cyxcclxuICAgICAgZ2V0U2VsZWN0UmVmOiB0aGlzLmdldFNlbGVjdFJlZixcclxuICAgICAgaXNTZWxlY3RlZDogdGhpcy5pc1NlbGVjdGVkLFxyXG4gICAgICBnZXRTZWxlY3RCb3VuZHM6IHRoaXMuZ2V0U2VsZWN0Qm91bmRzLFxyXG4gICAgICBhcmVBbGxTZWxlY3RlZDogdGhpcy5hcmVBbGxTZWxlY3RlZCxcclxuICAgICAgaGFuZGxlS2V5RG93bjogdGhpcy5oYW5kbGVLZXlEb3duLFxyXG4gICAgICBhY3RpdmVDdXJzb3JJdGVtOiB0aGlzLmFjdGl2ZUN1cnNvckl0ZW0sXHJcbiAgICAgIGNyZWF0ZU5ldzogdGhpcy5jcmVhdGVOZXcsXHJcbiAgICAgIHNvcnRCeTogdGhpcy5zb3J0QnksXHJcbiAgICAgIHNhZmVTdHJpbmc6IHRoaXMuc2FmZVN0cmluZ1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnNlbGVjdCA9IFJlYWN0LmNyZWF0ZVJlZigpO1xyXG4gICAgdGhpcy5kcm9wZG93blJvb3QgPSB0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gIH1cclxuXHJcbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICB0aGlzLnByb3BzLnBvcnRhbCAmJiB0aGlzLnByb3BzLnBvcnRhbC5hcHBlbmRDaGlsZCh0aGlzLmRyb3Bkb3duUm9vdCk7XHJcbiAgICBpc29tb3JwaGljV2luZG93KCkuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZGVib3VuY2UodGhpcy51cGRhdGVTZWxlY3RCb3VuZHMpKTtcclxuICAgIFxyXG4gICAgaWYgKHRoaXMucHJvcHMuc2Nyb2xsQ29udGFpbmVyKSB7XHJcbiAgICAgIHRoaXMucHJvcHMuc2Nyb2xsQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGRlYm91bmNlKHRoaXMub25TY3JvbGwpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlzb21vcnBoaWNXaW5kb3coKS5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBkZWJvdW5jZSh0aGlzLm9uU2Nyb2xsKSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5kcm9wRG93bignY2xvc2UnKTtcclxuXHJcbiAgICBpZiAodGhpcy5zZWxlY3QpIHtcclxuICAgICAgdGhpcy51cGRhdGVTZWxlY3RCb3VuZHMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMsIHByZXZTdGF0ZSkge1xyXG4gICAgaWYgKFxyXG4gICAgICAhaXNFcXVhbChwcmV2UHJvcHMudmFsdWVzLCB0aGlzLnByb3BzLnZhbHVlcykgJiZcclxuICAgICAgaXNFcXVhbChwcmV2UHJvcHMudmFsdWVzLCBwcmV2U3RhdGUudmFsdWVzKVxyXG4gICAgKSB7XHJcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgIHZhbHVlczogdGhpcy5wcm9wcy52YWx1ZXNcclxuICAgICAgfSwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25DaGFuZ2UodGhpcy5zdGF0ZS52YWx1ZXMpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy51cGRhdGVTZWxlY3RCb3VuZHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocHJldlN0YXRlLnZhbHVlcyAhPT0gdGhpcy5zdGF0ZS52YWx1ZXMpIHtcclxuICAgICAgdGhpcy5wcm9wcy5vbkNoYW5nZSh0aGlzLnN0YXRlLnZhbHVlcyk7XHJcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0Qm91bmRzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHByZXZTdGF0ZS5zZWFyY2ggIT09IHRoaXMuc3RhdGUuc2VhcmNoKSB7XHJcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0Qm91bmRzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHByZXZTdGF0ZS52YWx1ZXMgIT09IHRoaXMuc3RhdGUudmFsdWVzICYmIHRoaXMucHJvcHMuY2xvc2VPblNlbGVjdCkge1xyXG4gICAgICB0aGlzLmRyb3BEb3duKCdjbG9zZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChwcmV2UHJvcHMubXVsdGkgIT09IHRoaXMucHJvcHMubXVsdGkpIHtcclxuICAgICAgdGhpcy51cGRhdGVTZWxlY3RCb3VuZHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocHJldlN0YXRlLmRyb3Bkb3duICYmIHByZXZTdGF0ZS5kcm9wZG93biAhPT0gdGhpcy5zdGF0ZS5kcm9wZG93bikge1xyXG4gICAgICB0aGlzLm9uRHJvcGRvd25DbG9zZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghcHJldlN0YXRlLmRyb3Bkb3duICYmIHByZXZTdGF0ZS5kcm9wZG93biAhPT0gdGhpcy5zdGF0ZS5kcm9wZG93bikge1xyXG4gICAgICB0aGlzLnVwZGF0ZVNlbGVjdEJvdW5kcygpO1xyXG4gICAgICB0aGlzLnByb3BzLm9uRHJvcGRvd25PcGVuKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMucHJvcHMucG9ydGFsICYmIHByZXZQcm9wcy5wb3J0YWwgIT09IHRoaXMucHJvcHMucG9ydGFsKSB7XHJcbiAgICAgIHRoaXMucHJvcHMucG9ydGFsICYmIHRoaXMucHJvcHMucG9ydGFsLmFwcGVuZENoaWxkKHRoaXMuZHJvcGRvd25Sb290KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXRoaXMucHJvcHMucG9ydGFsICYmIHByZXZQcm9wcy5wb3J0YWwgIT09IHRoaXMucHJvcHMucG9ydGFsKSB7XHJcbiAgICAgIHRoaXMucHJvcHMucG9ydGFsICYmIHRoaXMucHJvcHMucG9ydGFsLnJlbW92ZUNoaWxkKHRoaXMuZHJvcGRvd25Sb290KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5wcm9wcy5zY3JvbGxDb250YWluZXIgJiYgcHJldlByb3BzLnNjcm9sbENvbnRhaW5lciAhPT0gdGhpcy5wcm9wcy5zY3JvbGxDb250YWluZXIpICB7XHJcbiAgICAgIHRoaXMucHJvcHMuc2Nyb2xsQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGRlYm91bmNlKHRoaXMub25TY3JvbGwpKTtcclxuICAgICAgaXNvbW9ycGhpY1dpbmRvdygpLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGRlYm91bmNlKHRoaXMub25TY3JvbGwsIHRoaXMucHJvcHMuZGVib3VuY2VEZWxheSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghdGhpcy5wcm9wcy5zY3JvbGxDb250YWluZXIgJiYgcHJldlByb3BzLnNjcm9sbENvbnRhaW5lciAhPT0gdGhpcy5wcm9wcy5zY3JvbGxDb250YWluZXIpICB7XHJcbiAgICAgIHRoaXMucHJvcHMuc2Nyb2xsQ29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGRlYm91bmNlKHRoaXMub25TY3JvbGwpKTtcclxuICAgICAgaXNvbW9ycGhpY1dpbmRvdygpLmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGRlYm91bmNlKHRoaXMub25TY3JvbGwpKTtcclxuICAgIH1cclxuLyogXHJcbiAgICBpZiAodGhpcy5wcm9wcy5vcGVuICYmIHByZXZQcm9wcy5vcGVuICE9PSB0aGlzLnByb3BzLm9wZW4pIHtcclxuICAgICAgdGhpcy5kcm9wRG93bignb3BlbicpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLnByb3BzLm9wZW4gJiYgcHJldlByb3BzLm9wZW4gIT09IHRoaXMucHJvcHMub3Blbikge1xyXG4gICAgICB0aGlzLmRyb3BEb3duKCdjbG9zZScpO1xyXG4gICAgfSAqL1xyXG4gIH1cclxuXHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcbiAgICB0aGlzLnByb3BzLnBvcnRhbCAmJiB0aGlzLnByb3BzLnBvcnRhbC5yZW1vdmVDaGlsZCh0aGlzLmRyb3Bkb3duUm9vdCk7XHJcbiAgICBpc29tb3JwaGljV2luZG93KCkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcclxuICAgICAgJ3Jlc2l6ZScsXHJcbiAgICAgIGRlYm91bmNlKHRoaXMudXBkYXRlU2VsZWN0Qm91bmRzLCB0aGlzLnByb3BzLmRlYm91bmNlRGVsYXkpXHJcbiAgICApO1xyXG5cclxuICAgIGlmICh0aGlzLnByb3BzLnNjcm9sbENvbnRhaW5lcikge1xyXG4gICAgICB0aGlzLnByb3BzLnNjcm9sbENvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBkZWJvdW5jZSh0aGlzLm9uU2Nyb2xsLCB0aGlzLnByb3BzLmRlYm91bmNlRGVsYXkpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlzb21vcnBoaWNXaW5kb3coKS5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBkZWJvdW5jZSh0aGlzLm9uU2Nyb2xsLCB0aGlzLnByb3BzLmRlYm91bmNlRGVsYXkpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9uRHJvcGRvd25DbG9zZSA9ICgpID0+IHtcclxuICAgIHRoaXMuc2V0U3RhdGUoeyBjdXJzb3I6IG51bGwgfSk7XHJcbiAgICB0aGlzLnByb3BzLm9uRHJvcGRvd25DbG9zZSgpO1xyXG4gIH07XHJcblxyXG4gIG9uU2Nyb2xsID0gKCkgPT4ge1xyXG4gICAgaWYgKHRoaXMucHJvcHMuY2xvc2VPblNjcm9sbCkge1xyXG4gICAgICB0aGlzLmRyb3BEb3duKCdjbG9zZScpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMudXBkYXRlU2VsZWN0Qm91bmRzKCk7XHJcbiAgfTtcclxuXHJcbiAgdXBkYXRlU2VsZWN0Qm91bmRzID0gKCkgPT5cclxuICAgIHRoaXMuc2VsZWN0LmN1cnJlbnQgJiZcclxuICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICBzZWxlY3RCb3VuZHM6IHRoaXMuc2VsZWN0LmN1cnJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcclxuICAgIH0pO1xyXG5cclxuICBnZXRTZWxlY3RCb3VuZHMgPSAoKSA9PiB0aGlzLnN0YXRlLnNlbGVjdEJvdW5kcztcclxuXHJcbiAgZHJvcERvd24gPSAoYWN0aW9uID0gJ3RvZ2dsZScsIGV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCB0YXJnZXQgPSAoZXZlbnQgJiYgZXZlbnQudGFyZ2V0KSB8fCAoZXZlbnQgJiYgZXZlbnQuc3JjRWxlbWVudCk7XHJcblxyXG4gICAgaWYgKFxyXG4gICAgICB0aGlzLnByb3BzLnBvcnRhbCAmJlxyXG4gICAgICAhdGhpcy5wcm9wcy5jbG9zZU9uU2Nyb2xsICYmXHJcbiAgICAgICF0aGlzLnByb3BzLmNsb3NlT25TZWxlY3QgJiZcclxuICAgICAgZXZlbnQgJiZcclxuICAgICAgdGFyZ2V0ICYmXHJcbiAgICAgIHRhcmdldC5vZmZzZXRQYXJlbnQgJiZcclxuICAgICAgdGFyZ2V0Lm9mZnNldFBhcmVudC5jbGFzc0xpc3QuY29udGFpbnMoJ3JlYWN0LWRyb3Bkb3duLXNlbGVjdC1kcm9wZG93bicpXHJcbiAgICApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLnByb3BzLmtlZXBPcGVuKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnNldFN0YXRlKHsgZHJvcGRvd246IHRydWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGFjdGlvbiA9PT0gJ2Nsb3NlJyAmJiB0aGlzLnN0YXRlLmRyb3Bkb3duKSB7XHJcbiAgICAgIHRoaXMuc2VsZWN0LmN1cnJlbnQuYmx1cigpO1xyXG5cclxuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgIGRyb3Bkb3duOiBmYWxzZSxcclxuICAgICAgICBzZWFyY2g6IHRoaXMucHJvcHMuY2xlYXJPbkJsdXIgPyAnJyA6IHRoaXMuc3RhdGUuc2VhcmNoXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhY3Rpb24gPT09ICdvcGVuJyAmJiAhdGhpcy5zdGF0ZS5kcm9wZG93bikge1xyXG4gICAgICByZXR1cm4gdGhpcy5zZXRTdGF0ZSh7IGRyb3Bkb3duOiB0cnVlIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhY3Rpb24gPT09ICd0b2dnbGUnKSB7XHJcbiAgICAgIHRoaXMuc2VsZWN0LmN1cnJlbnQuZm9jdXMoKTtcclxuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoeyBkcm9wZG93bjogIXRoaXMuc3RhdGUuZHJvcGRvd24gfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH07XHJcblxyXG4gIGdldFNlbGVjdFJlZiA9ICgpID0+IHRoaXMuc2VsZWN0LmN1cnJlbnQ7XHJcblxyXG4gIGFkZEl0ZW0gPSAoaXRlbSkgPT4ge1xyXG4gICAgaWYgKHRoaXMucHJvcHMubXVsdGkpIHtcclxuICAgICAgaWYgKFxyXG4gICAgICAgIHZhbHVlRXhpc3RJblNlbGVjdGVkKGdldEJ5UGF0aChpdGVtLCB0aGlzLnByb3BzLnZhbHVlRmllbGQpLCB0aGlzLnN0YXRlLnZhbHVlcywgdGhpcy5wcm9wcylcclxuICAgICAgKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlSXRlbShudWxsLCBpdGVtLCBmYWxzZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgIHZhbHVlczogWy4uLnRoaXMuc3RhdGUudmFsdWVzLCBpdGVtXVxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgIHZhbHVlczogW2l0ZW1dLFxyXG4gICAgICAgIGRyb3Bkb3duOiBmYWxzZVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnByb3BzLmNsZWFyT25TZWxlY3QgJiYgdGhpcy5zZXRTdGF0ZSh7IHNlYXJjaDogJycgfSk7XHJcblxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfTtcclxuXHJcbiAgcmVtb3ZlSXRlbSA9IChldmVudCwgaXRlbSwgY2xvc2UgPSBmYWxzZSkgPT4ge1xyXG4gICAgaWYgKGV2ZW50ICYmIGNsb3NlKSB7XHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICB0aGlzLmRyb3BEb3duKCdjbG9zZScpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICB2YWx1ZXM6IHRoaXMuc3RhdGUudmFsdWVzLmZpbHRlcihcclxuICAgICAgICAodmFsdWVzKSA9PlxyXG4gICAgICAgICAgZ2V0QnlQYXRoKHZhbHVlcywgdGhpcy5wcm9wcy52YWx1ZUZpZWxkKSAhPT0gZ2V0QnlQYXRoKGl0ZW0sIHRoaXMucHJvcHMudmFsdWVGaWVsZClcclxuICAgICAgKVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgc2V0U2VhcmNoID0gKGV2ZW50KSA9PiB7XHJcbiAgICB0aGlzLnNldFN0YXRlKHtcclxuICAgICAgY3Vyc29yOiBudWxsXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLnNldFN0YXRlKHtcclxuICAgICAgc2VhcmNoOiBldmVudC50YXJnZXQudmFsdWVcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGdldElucHV0U2l6ZSA9ICgpID0+IHtcclxuICAgIGlmICh0aGlzLnN0YXRlLnNlYXJjaCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5zdGF0ZS5zZWFyY2gubGVuZ3RoO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLnN0YXRlLnZhbHVlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnByb3BzLmFkZFBsYWNlaG9sZGVyLmxlbmd0aDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5wbGFjZWhvbGRlci5sZW5ndGg7XHJcbiAgfTtcclxuXHJcbiAgdG9nZ2xlU2VsZWN0QWxsID0gKCkgPT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICB2YWx1ZXM6IHRoaXMuc3RhdGUudmFsdWVzLmxlbmd0aCA9PT0gMCA/IHRoaXMuc2VsZWN0QWxsKCkgOiB0aGlzLmNsZWFyQWxsKClcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGNsZWFyQWxsID0gKCkgPT4ge1xyXG4gICAgdGhpcy5wcm9wcy5vbkNsZWFyQWxsKCk7XHJcbiAgICB0aGlzLnNldFN0YXRlKHtcclxuICAgICAgdmFsdWVzOiBbXVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgc2VsZWN0QWxsID0gKHZhbHVlc0xpc3Q9W10pID0+IHtcclxuICAgIHRoaXMucHJvcHMub25TZWxlY3RBbGwoKTtcclxuICAgIGNvbnN0IHZhbHVlcyA9IHZhbHVlc0xpc3QubGVuZ3RoID4gMFxyXG4gICAgICA/IHZhbHVlc0xpc3RcclxuICAgICAgOiB0aGlzLnByb3BzLm9wdGlvbnMuZmlsdGVyKChvcHRpb24pID0+ICFvcHRpb24uZGlzYWJsZWQpO1xyXG5cclxuICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZXMgfSk7XHJcbiAgfTtcclxuXHJcbiAgaXNTZWxlY3RlZCA9IChvcHRpb24pID0+XHJcbiAgICAhIXRoaXMuc3RhdGUudmFsdWVzLmZpbmQoXHJcbiAgICAgICh2YWx1ZSkgPT5cclxuICAgICAgICBnZXRCeVBhdGgodmFsdWUsIHRoaXMucHJvcHMudmFsdWVGaWVsZCkgPT09IGdldEJ5UGF0aChvcHRpb24sIHRoaXMucHJvcHMudmFsdWVGaWVsZClcclxuICAgICk7XHJcblxyXG4gIGFyZUFsbFNlbGVjdGVkID0gKCkgPT5cclxuICAgIHRoaXMuc3RhdGUudmFsdWVzLmxlbmd0aCA9PT0gdGhpcy5wcm9wcy5vcHRpb25zLmZpbHRlcigob3B0aW9uKSA9PiAhb3B0aW9uLmRpc2FibGVkKS5sZW5ndGg7XHJcblxyXG4gIHNhZmVTdHJpbmcgPSAoc3RyaW5nKSA9PiBzdHJpbmcucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csICdcXFxcJCYnKTtcclxuXHJcbiAgc29ydEJ5ID0gKCkgPT4ge1xyXG4gICAgY29uc3QgeyBzb3J0QnksIG9wdGlvbnMgfSA9IHRoaXMucHJvcHM7XHJcblxyXG4gICAgaWYgKCFzb3J0QnkpIHtcclxuICAgICAgcmV0dXJuIG9wdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgb3B0aW9ucy5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgIGlmIChnZXRQcm9wKGEsIHNvcnRCeSkgPCBnZXRQcm9wKGIsIHNvcnRCeSkpIHtcclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgIH0gZWxzZSBpZiAoZ2V0UHJvcChhLCBzb3J0QnkpID4gZ2V0UHJvcChiLCBzb3J0QnkpKSB7XHJcbiAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBvcHRpb25zO1xyXG4gIH07XHJcblxyXG4gIHNlYXJjaEZuID0gKHsgc3RhdGUsIG1ldGhvZHMgfSkgPT4ge1xyXG4gICAgY29uc3QgcmVnZXhwID0gbmV3IFJlZ0V4cChtZXRob2RzLnNhZmVTdHJpbmcoc3RhdGUuc2VhcmNoKSwgJ2knKTtcclxuXHJcbiAgICByZXR1cm4gbWV0aG9kc1xyXG4gICAgICAuc29ydEJ5KClcclxuICAgICAgLmZpbHRlcigoaXRlbSkgPT5cclxuICAgICAgICByZWdleHAudGVzdChnZXRCeVBhdGgoaXRlbSwgdGhpcy5wcm9wcy5zZWFyY2hCeSkgfHwgZ2V0QnlQYXRoKGl0ZW0sIHRoaXMucHJvcHMudmFsdWVGaWVsZCkpXHJcbiAgICAgICk7XHJcbiAgfTtcclxuXHJcbiAgc2VhcmNoUmVzdWx0cyA9ICgpID0+IHtcclxuICAgIGNvbnN0IGFyZ3MgPSB7IHN0YXRlOiB0aGlzLnN0YXRlLCBwcm9wczogdGhpcy5wcm9wcywgbWV0aG9kczogdGhpcy5tZXRob2RzIH07XHJcblxyXG4gICAgcmV0dXJuIHRoaXMucHJvcHMuc2VhcmNoRm4oYXJncykgfHwgdGhpcy5zZWFyY2hGbihhcmdzKTtcclxuICB9O1xyXG5cclxuICBhY3RpdmVDdXJzb3JJdGVtID0gKGFjdGl2ZUN1cnNvckl0ZW0pID0+XHJcbiAgICB0aGlzLnNldFN0YXRlKHtcclxuICAgICAgYWN0aXZlQ3Vyc29ySXRlbVxyXG4gICAgfSk7XHJcblxyXG4gIGhhbmRsZUtleURvd24gPSAoZXZlbnQpID0+IHtcclxuICAgIGNvbnN0IGFyZ3MgPSB7XHJcbiAgICAgIGV2ZW50LFxyXG4gICAgICBzdGF0ZTogdGhpcy5zdGF0ZSxcclxuICAgICAgcHJvcHM6IHRoaXMucHJvcHMsXHJcbiAgICAgIG1ldGhvZHM6IHRoaXMubWV0aG9kcyxcclxuICAgICAgc2V0U3RhdGU6IHRoaXMuc2V0U3RhdGUuYmluZCh0aGlzKVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5oYW5kbGVLZXlEb3duRm4oYXJncykgfHwgdGhpcy5oYW5kbGVLZXlEb3duRm4oYXJncyk7XHJcbiAgfTtcclxuXHJcbiAgaGFuZGxlS2V5RG93bkZuID0gKHsgZXZlbnQsIHN0YXRlLCBwcm9wcywgbWV0aG9kcywgc2V0U3RhdGUgfSkgPT4ge1xyXG4gICAgY29uc3QgeyBjdXJzb3IgfSA9IHN0YXRlO1xyXG4gICAgY29uc3QgZXNjYXBlID0gZXZlbnQua2V5ID09PSAnRXNjYXBlJztcclxuICAgIGNvbnN0IGVudGVyID0gZXZlbnQua2V5ID09PSAnRW50ZXInO1xyXG4gICAgY29uc3QgYXJyb3dVcCA9IGV2ZW50LmtleSA9PT0gJ0Fycm93VXAnO1xyXG4gICAgY29uc3QgYXJyb3dEb3duID0gZXZlbnQua2V5ID09PSAnQXJyb3dEb3duJztcclxuICAgIGNvbnN0IGJhY2tzcGFjZSA9IGV2ZW50LmtleSA9PT0gJ0JhY2tzcGFjZSc7XHJcbiAgICAgIGNvbnN0IHRhYiA9IGV2ZW50LmtleSA9PT0gJ1RhYicgJiYgIWV2ZW50LnNoaWZ0S2V5O1xyXG4gICAgY29uc3Qgc2hpZnRUYWIgPSBldmVudC5zaGlmdEtleSAmJiBldmVudC5rZXkgPT09ICdUYWInO1xyXG5cclxuICAgIGlmICgoYXJyb3dEb3duIHx8IHRhYikgJiYgY3Vyc29yID09PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiBzZXRTdGF0ZSh7XHJcbiAgICAgICAgY3Vyc29yOiAwXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhcnJvd1VwIHx8IGFycm93RG93biB8fCBzaGlmdFRhYiB8fCB0YWIpIHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZXNjYXBlKSB7XHJcbiAgICAgIHRoaXMuZHJvcERvd24oJ2Nsb3NlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGVudGVyKSB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRJdGVtID0gbWV0aG9kcy5zZWFyY2hSZXN1bHRzKClbY3Vyc29yXTtcclxuICAgICAgaWYgKGN1cnJlbnRJdGVtICYmICFjdXJyZW50SXRlbS5kaXNhYmxlZCkge1xyXG4gICAgICAgIGlmIChwcm9wcy5jcmVhdGUgJiYgdmFsdWVFeGlzdEluU2VsZWN0ZWQoc3RhdGUuc2VhcmNoLCBzdGF0ZS52YWx1ZXMsIHByb3BzKSkge1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBtZXRob2RzLmFkZEl0ZW0oY3VycmVudEl0ZW0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKChhcnJvd0Rvd24gfHwgdGFiKSAmJiBtZXRob2RzLnNlYXJjaFJlc3VsdHMoKS5sZW5ndGggPT09IGN1cnNvcikge1xyXG4gICAgICByZXR1cm4gc2V0U3RhdGUoe1xyXG4gICAgICAgIGN1cnNvcjogMFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYXJyb3dEb3duIHx8IHRhYikge1xyXG4gICAgICBzZXRTdGF0ZSgocHJldlN0YXRlKSA9PiAoe1xyXG4gICAgICAgIGN1cnNvcjogcHJldlN0YXRlLmN1cnNvciArIDFcclxuICAgICAgfSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICgoYXJyb3dVcCB8fCBzaGlmdFRhYikgJiYgY3Vyc29yID4gMCkge1xyXG4gICAgICBzZXRTdGF0ZSgocHJldlN0YXRlKSA9PiAoe1xyXG4gICAgICAgIGN1cnNvcjogcHJldlN0YXRlLmN1cnNvciAtIDFcclxuICAgICAgfSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICgoYXJyb3dVcCB8fCBzaGlmdFRhYikgJiYgY3Vyc29yID09PSAwKSB7XHJcbiAgICAgIHNldFN0YXRlKHtcclxuICAgICAgICBjdXJzb3I6IG1ldGhvZHMuc2VhcmNoUmVzdWx0cygpLmxlbmd0aFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYmFja3NwYWNlICYmIHByb3BzLm11bHRpICYmIHByb3BzLmJhY2tzcGFjZURlbGV0ZSAmJiB0aGlzLmdldElucHV0U2l6ZSgpID09PSAwKSB7XHJcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgIHZhbHVlczogdGhpcy5zdGF0ZS52YWx1ZXMuc2xpY2UoMCwgLTEpXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHJlbmRlckRyb3Bkb3duID0gKCkgPT5cclxuICAgIHRoaXMucHJvcHMucG9ydGFsID8gKFxyXG4gICAgICBSZWFjdERPTS5jcmVhdGVQb3J0YWwoXHJcbiAgICAgICAgPERyb3Bkb3duIHByb3BzPXt0aGlzLnByb3BzfSBzdGF0ZT17dGhpcy5zdGF0ZX0gbWV0aG9kcz17dGhpcy5tZXRob2RzfSAvPixcclxuICAgICAgICB0aGlzLmRyb3Bkb3duUm9vdFxyXG4gICAgICApXHJcbiAgICApIDogKFxyXG4gICAgICA8RHJvcGRvd24gcHJvcHM9e3RoaXMucHJvcHN9IHN0YXRlPXt0aGlzLnN0YXRlfSBtZXRob2RzPXt0aGlzLm1ldGhvZHN9IC8+XHJcbiAgICApO1xyXG5cclxuICBjcmVhdGVOZXcgPSAoaXRlbSkgPT4ge1xyXG4gICAgY29uc3QgbmV3VmFsdWUgPSB7XHJcbiAgICAgIFt0aGlzLnByb3BzLmxhYmVsRmllbGRdOiBpdGVtLFxyXG4gICAgICBbdGhpcy5wcm9wcy52YWx1ZUZpZWxkXTogaXRlbVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmFkZEl0ZW0obmV3VmFsdWUpO1xyXG4gICAgdGhpcy5wcm9wcy5vbkNyZWF0ZU5ldyhuZXdWYWx1ZSk7XHJcbiAgICB0aGlzLnNldFN0YXRlKHsgc2VhcmNoOiAnJyB9KTtcclxuICB9O1xyXG5cclxuICByZW5kZXIoKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8Q2xpY2tPdXRzaWRlIG9uQ2xpY2tPdXRzaWRlPXsoZXZlbnQpID0+IHRoaXMuZHJvcERvd24oJ2Nsb3NlJywgZXZlbnQpfT5cclxuICAgICAgICA8UmVhY3REcm9wZG93blNlbGVjdFxyXG4gICAgICAgICAgb25LZXlEb3duPXt0aGlzLmhhbmRsZUtleURvd259XHJcbiAgICAgICAgICBvbkNsaWNrPXsoZXZlbnQpID0+IHRoaXMuZHJvcERvd24odGhpcy5wcm9wcy50b2dnbGVPbk9wZW4gPyAndG9nZ2xlJyA6ICdvcGVuJywgZXZlbnQpfVxyXG4gICAgICAgICAgb25Gb2N1cz17KGV2ZW50KSA9PiB0aGlzLmRyb3BEb3duKCdvcGVuJywgZXZlbnQpfVxyXG4gICAgICAgICAgdGFiSW5kZXg9e3RoaXMucHJvcHMuZGlzYWJsZWQgPyAnLTEnIDogJzAnfVxyXG4gICAgICAgICAgZGlyZWN0aW9uPXt0aGlzLnByb3BzLmRpcmVjdGlvbn1cclxuICAgICAgICAgIHN0eWxlPXt0aGlzLnByb3BzLnN0eWxlfVxyXG4gICAgICAgICAgcmVmPXt0aGlzLnNlbGVjdH1cclxuICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnByb3BzLmRpc2FibGVkfVxyXG4gICAgICAgICAgY2xhc3NOYW1lPXtgJHtMSUJfTkFNRX0gJHt0aGlzLnByb3BzLmNsYXNzTmFtZX1gfVxyXG4gICAgICAgICAgY29sb3I9e3RoaXMucHJvcHMuY29sb3J9XHJcbiAgICAgICAgICB7Li4udGhpcy5wcm9wcy5hZGRpdGlvbmFsUHJvcHN9PlxyXG4gICAgICAgICAgPENvbnRlbnQgcHJvcHM9e3RoaXMucHJvcHN9IHN0YXRlPXt0aGlzLnN0YXRlfSBtZXRob2RzPXt0aGlzLm1ldGhvZHN9IC8+XHJcblxyXG4gICAgICAgICAgeyh0aGlzLnByb3BzLm5hbWUgfHwgdGhpcy5wcm9wcy5yZXF1aXJlZCkgJiYgKFxyXG4gICAgICAgICAgICA8aW5wdXRcclxuICAgICAgICAgICAgICB0YWJJbmRleD17LTF9XHJcbiAgICAgICAgICAgICAgc3R5bGU9e3sgb3BhY2l0eTogMCwgd2lkdGg6IDAsIHBvc2l0aW9uOiAnYWJzb2x1dGUnIH19XHJcbiAgICAgICAgICAgICAgbmFtZT17dGhpcy5wcm9wcy5uYW1lfVxyXG4gICAgICAgICAgICAgIHJlcXVpcmVkPXt0aGlzLnByb3BzLnJlcXVpcmVkfVxyXG4gICAgICAgICAgICAgIHBhdHRlcm49e3RoaXMucHJvcHMucGF0dGVybn1cclxuICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS52YWx1ZXMubWFwKHZhbHVlID0+IHZhbHVlW3RoaXMucHJvcHMubGFiZWxGaWVsZF0pLnRvU3RyaW5nKCkgfHwgW119XHJcbiAgICAgICAgICAgICAgZGlzYWJsZWQ9e3RoaXMucHJvcHMuZGlzYWJsZWR9XHJcbiAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICApfVxyXG5cclxuICAgICAgICAgIHt0aGlzLnByb3BzLmxvYWRpbmcgJiYgPExvYWRpbmcgcHJvcHM9e3RoaXMucHJvcHN9IC8+fVxyXG5cclxuICAgICAgICAgIHt0aGlzLnByb3BzLmNsZWFyYWJsZSAmJiAoXHJcbiAgICAgICAgICAgIDxDbGVhciBwcm9wcz17dGhpcy5wcm9wc30gc3RhdGU9e3RoaXMuc3RhdGV9IG1ldGhvZHM9e3RoaXMubWV0aG9kc30gLz5cclxuICAgICAgICAgICl9XHJcblxyXG4gICAgICAgICAge3RoaXMucHJvcHMuc2VwYXJhdG9yICYmIChcclxuICAgICAgICAgICAgPFNlcGFyYXRvciBwcm9wcz17dGhpcy5wcm9wc30gc3RhdGU9e3RoaXMuc3RhdGV9IG1ldGhvZHM9e3RoaXMubWV0aG9kc30gLz5cclxuICAgICAgICAgICl9XHJcblxyXG4gICAgICAgICAge3RoaXMucHJvcHMuZHJvcGRvd25IYW5kbGUgJiYgKFxyXG4gICAgICAgICAgICA8RHJvcGRvd25IYW5kbGVcclxuICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB0aGlzLnNlbGVjdC5jdXJyZW50LmZvY3VzKCl9XHJcbiAgICAgICAgICAgICAgcHJvcHM9e3RoaXMucHJvcHN9XHJcbiAgICAgICAgICAgICAgc3RhdGU9e3RoaXMuc3RhdGV9XHJcbiAgICAgICAgICAgICAgbWV0aG9kcz17dGhpcy5tZXRob2RzfVxyXG4gICAgICAgICAgICAvPlxyXG4gICAgICAgICAgKX1cclxuXHJcbiAgICAgICAgICB7dGhpcy5zdGF0ZS5kcm9wZG93biAmJiAhdGhpcy5wcm9wcy5kaXNhYmxlZCAmJiB0aGlzLnJlbmRlckRyb3Bkb3duKCl9XHJcbiAgICAgICAgPC9SZWFjdERyb3Bkb3duU2VsZWN0PlxyXG4gICAgICA8L0NsaWNrT3V0c2lkZT5cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5TZWxlY3QuZGVmYXVsdFByb3BzID0ge1xyXG4gIGFkZFBsYWNlaG9sZGVyOiAnJyxcclxuICBwbGFjZWhvbGRlcjogJ1NlbGVjdC4uLicsXHJcbiAgdmFsdWVzOiBbXSxcclxuICBvcHRpb25zOiBbXSxcclxuICBtdWx0aTogZmFsc2UsXHJcbiAgZGlzYWJsZWQ6IGZhbHNlLFxyXG4gIHNlYXJjaEJ5OiAnbGFiZWwnLFxyXG4gIHNvcnRCeTogbnVsbCxcclxuICBjbGVhcmFibGU6IGZhbHNlLFxyXG4gIHNlYXJjaGFibGU6IHRydWUsXHJcbiAgZHJvcGRvd25IYW5kbGU6IHRydWUsXHJcbiAgc2VwYXJhdG9yOiBmYWxzZSxcclxuICBrZWVwT3BlbjogdW5kZWZpbmVkLFxyXG4gIG5vRGF0YUxhYmVsOiAnTm8gZGF0YScsXHJcbiAgY3JlYXRlTmV3TGFiZWw6ICdhZGQge3NlYXJjaH0nLFxyXG4gIGRpc2FibGVkTGFiZWw6ICdkaXNhYmxlZCcsXHJcbiAgZHJvcGRvd25HYXA6IDUsXHJcbiAgY2xvc2VPblNjcm9sbDogZmFsc2UsXHJcbiAgZGVib3VuY2VEZWxheTogMCxcclxuICBsYWJlbEZpZWxkOiAnbGFiZWwnLFxyXG4gIHZhbHVlRmllbGQ6ICd2YWx1ZScsXHJcbiAgY29sb3I6ICcjMDA3NEQ5JyxcclxuICBrZWVwU2VsZWN0ZWRJbkxpc3Q6IHRydWUsXHJcbiAgY2xvc2VPblNlbGVjdDogZmFsc2UsXHJcbiAgY2xlYXJPbkJsdXI6IHRydWUsXHJcbiAgY2xlYXJPblNlbGVjdDogdHJ1ZSxcclxuICBkcm9wZG93blBvc2l0aW9uOiAnYm90dG9tJyxcclxuICBkcm9wZG93bkhlaWdodDogJzMwMHB4JyxcclxuICBhdXRvRm9jdXM6IGZhbHNlLFxyXG4gIHBvcnRhbDogbnVsbCxcclxuICBjcmVhdGU6IGZhbHNlLFxyXG4gIGRpcmVjdGlvbjogJ2x0cicsXHJcbiAgbmFtZTogbnVsbCxcclxuICByZXF1aXJlZDogZmFsc2UsXHJcbiAgcGF0dGVybjogZmFsc2UsXHJcbiAgb25DaGFuZ2U6ICgpID0+IHVuZGVmaW5lZCxcclxuICBvbkRyb3Bkb3duT3BlbjogKCkgPT4gdW5kZWZpbmVkLFxyXG4gIG9uRHJvcGRvd25DbG9zZTogKCkgPT4gdW5kZWZpbmVkLFxyXG4gIG9uQ2xlYXJBbGw6ICgpID0+IHVuZGVmaW5lZCxcclxuICBvblNlbGVjdEFsbDogKCkgPT4gdW5kZWZpbmVkLFxyXG4gIG9uQ3JlYXRlTmV3OiAoKSA9PiB1bmRlZmluZWQsXHJcbiAgc2VhcmNoRm46ICgpID0+IHVuZGVmaW5lZCxcclxuICBoYW5kbGVLZXlEb3duRm46ICgpID0+IHVuZGVmaW5lZCxcclxuICBhZGRpdGlvbmFsUHJvcHM6IG51bGwsXHJcbiAgYmFja3NwYWNlRGVsZXRlOiB0cnVlXHJcbn07XHJcblxyXG5jb25zdCBSZWFjdERyb3Bkb3duU2VsZWN0ID0gc3R5bGVkLmRpdmBcclxuICBwb3NpdGlvbjogcmVsYXRpdmU7XHJcbiAgZGlzcGxheTogZmxleDtcclxuICBib3JkZXI6IDFweCBzb2xpZCAjY2NjO1xyXG4gIHdpZHRoOiAxMDAlO1xyXG4gIGJvcmRlci1yYWRpdXM6IDJweDtcclxuICBwYWRkaW5nOiAycHggNXB4O1xyXG4gIGZsZXgtZGlyZWN0aW9uOiByb3c7XHJcbiAgZGlyZWN0aW9uOiAkeyh7IGRpcmVjdGlvbiB9KSA9PiBkaXJlY3Rpb259O1xyXG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XHJcbiAgY3Vyc29yOiBwb2ludGVyO1xyXG4gIG1pbi1oZWlnaHQ6IDM2cHg7XHJcbiAgJHsoeyBkaXNhYmxlZCB9KSA9PlxyXG4gICAgZGlzYWJsZWQgPyAnY3Vyc29yOiBub3QtYWxsb3dlZDtwb2ludGVyLWV2ZW50czogbm9uZTtvcGFjaXR5OiAwLjM7JyA6ICdwb2ludGVyLWV2ZW50czogYWxsOyd9XHJcblxyXG4gIDpob3ZlcixcclxuICA6Zm9jdXMtd2l0aGluIHtcclxuICAgIGJvcmRlci1jb2xvcjogJHsoeyBjb2xvciB9KSA9PiBjb2xvcn07XHJcbiAgfVxyXG5cclxuICA6Zm9jdXMsXHJcbiAgOmZvY3VzLXdpdGhpbiB7XHJcbiAgICBvdXRsaW5lOiAwO1xyXG4gICAgYm94LXNoYWRvdzogMCAwIDAgM3B4ICR7KHsgY29sb3IgfSkgPT4gaGV4VG9SR0JBKGNvbG9yLCAwLjIpfTtcclxuICB9XHJcbmA7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBTZWxlY3Q7XHJcbiJdfQ== */")),_default=Select;exports.default=_default;