"use strict";exports.__esModule=!0,exports.default=exports.Select=void 0;var _styledBase=_interopRequireDefault(require("@emotion/styled-base")),_react=_interopRequireWildcard(require("react")),_reactDom=_interopRequireDefault(require("react-dom")),_propTypes=_interopRequireDefault(require("prop-types")),_ClickOutside=_interopRequireDefault(require("./components/ClickOutside")),_Content=_interopRequireDefault(require("./components/Content")),_Dropdown=_interopRequireDefault(require("./components/Dropdown")),_Loading=_interopRequireDefault(require("./components/Loading")),_Clear=_interopRequireDefault(require("./components/Clear")),_Separator=_interopRequireDefault(require("./components/Separator")),_DropdownHandle=_interopRequireDefault(require("./components/DropdownHandle")),_util=require("./util"),_constants=require("./constants");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;return _getRequireWildcardCache=function(){return a},a}function _interopRequireWildcard(a){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var b=_getRequireWildcardCache();if(b&&b.has(a))return b.get(a);var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;f&&(f.get||f.set)?Object.defineProperty(c,e,f):c[e]=a[e]}return c.default=a,b&&b.set(a,c),c}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var Select=/*#__PURE__*/function(a){function b(b){var c;return c=a.call(this,b)||this,_defineProperty(_assertThisInitialized(c),"onDropdownClose",function(){c.setState({cursor:null}),c.props.onDropdownClose()}),_defineProperty(_assertThisInitialized(c),"onScroll",function(){c.props.closeOnScroll&&c.dropDown("close"),c.updateSelectBounds()}),_defineProperty(_assertThisInitialized(c),"updateSelectBounds",function(){return c.select.current&&c.setState({selectBounds:c.select.current.getBoundingClientRect()})}),_defineProperty(_assertThisInitialized(c),"getSelectBounds",function(){return c.state.selectBounds}),_defineProperty(_assertThisInitialized(c),"dropDown",function(a,b){void 0===a&&(a="toggle");var d=b&&b.target||b&&b.srcElement;return c.props.portal&&!c.props.closeOnScroll&&!c.props.closeOnSelect&&b&&d&&d.offsetParent&&d.offsetParent.classList.contains("react-dropdown-select-dropdown")?void 0:c.props.keepOpen?c.setState({dropdown:!0}):"close"===a&&c.state.dropdown?(c.select.current.blur(),c.setState({dropdown:!1,search:c.props.clearOnBlur?"":c.state.search})):"open"!==a||c.state.dropdown?"toggle"===a&&(c.select.current.focus(),c.setState({dropdown:!c.state.dropdown})):c.setState({dropdown:!0})}),_defineProperty(_assertThisInitialized(c),"getSelectRef",function(){return c.select.current}),_defineProperty(_assertThisInitialized(c),"addItem",function(a){if(c.props.multi){if((0,_util.valueExistInSelected)((0,_util.getByPath)(a,c.props.valueField),c.state.values,c.props))return c.removeItem(null,a,!1);c.setState({values:[].concat(c.state.values,[a])})}else c.setState({values:[a],dropdown:!1});return c.props.clearOnSelect&&c.setState({search:""}),!0}),_defineProperty(_assertThisInitialized(c),"removeItem",function(a,b,d){void 0===d&&(d=!1),a&&d&&(a.preventDefault(),a.stopPropagation(),c.dropDown("close")),c.setState({values:c.state.values.filter(function(a){return(0,_util.getByPath)(a,c.props.valueField)!==(0,_util.getByPath)(b,c.props.valueField)})})}),_defineProperty(_assertThisInitialized(c),"setSearch",function(a){c.setState({cursor:null}),c.setState({search:a.target.value})}),_defineProperty(_assertThisInitialized(c),"getInputSize",function(){return c.state.search?c.state.search.length:0<c.state.values.length?c.props.addPlaceholder.length:c.props.placeholder.length}),_defineProperty(_assertThisInitialized(c),"toggleSelectAll",function(){return c.setState({values:0===c.state.values.length?c.selectAll():c.clearAll()})}),_defineProperty(_assertThisInitialized(c),"clearAll",function(){c.props.onClearAll(),c.setState({values:[]})}),_defineProperty(_assertThisInitialized(c),"selectAll",function(a){void 0===a&&(a=[]),c.props.onSelectAll();var b=0<a.length?a:c.props.options.filter(function(a){return!a.disabled});c.setState({values:b})}),_defineProperty(_assertThisInitialized(c),"isSelected",function(a){return!!c.state.values.find(function(b){return(0,_util.getByPath)(b,c.props.valueField)===(0,_util.getByPath)(a,c.props.valueField)})}),_defineProperty(_assertThisInitialized(c),"areAllSelected",function(){return c.state.values.length===c.props.options.filter(function(a){return!a.disabled}).length}),_defineProperty(_assertThisInitialized(c),"safeString",function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}),_defineProperty(_assertThisInitialized(c),"sortBy",function(){var a=c.props,d=a.sortBy,e=a.options;return d?(e.sort(function(c,a){return(0,_util.getProp)(c,d)<(0,_util.getProp)(a,d)?-1:(0,_util.getProp)(c,d)>(0,_util.getProp)(a,d)?1:0}),e):e}),_defineProperty(_assertThisInitialized(c),"searchFn",function(a){var b=a.state,d=a.methods,e=new RegExp(d.safeString(b.search),"i");return d.sortBy().filter(function(a){return e.test((0,_util.getByPath)(a,c.props.searchBy)||(0,_util.getByPath)(a,c.props.valueField))})}),_defineProperty(_assertThisInitialized(c),"searchResults",function(){var a={state:c.state,props:c.props,methods:c.methods};return c.props.searchFn(a)||c.searchFn(a)}),_defineProperty(_assertThisInitialized(c),"activeCursorItem",function(a){return c.setState({activeCursorItem:a})}),_defineProperty(_assertThisInitialized(c),"handleKeyDown",function(a){var b={event:a,state:c.state,props:c.props,methods:c.methods,setState:c.setState.bind(_assertThisInitialized(c))};return c.props.handleKeyDownFn(b)||c.handleKeyDownFn(b)}),_defineProperty(_assertThisInitialized(c),"handleKeyDownFn",function(a){var b=a.event,d=a.state,e=a.props,f=a.methods,g=a.setState,h=d.cursor,i="Escape"===b.key,j="Enter"===b.key,k="ArrowUp"===b.key,l="ArrowDown"===b.key,m="Backspace"===b.key,n="Tab"===b.key&&!b.shiftKey,o=b.shiftKey&&"Tab"===b.key;if((l||n)&&null===h)return g({cursor:0});if((k||l||o||n)&&b.preventDefault(),i&&c.dropDown("close"),j){var p=f.searchResults()[h];if(p&&!p.disabled){if(e.create&&(0,_util.valueExistInSelected)(d.search,d.values,e))return null;f.addItem(p)}}return(l||n)&&f.searchResults().length===h?g({cursor:0}):void((l||n)&&g(function(a){return{cursor:a.cursor+1}}),(k||o)&&0<h&&g(function(a){return{cursor:a.cursor-1}}),(k||o)&&0===h&&g({cursor:f.searchResults().length}),m&&e.multi&&e.backspaceDelete&&0===c.getInputSize()&&c.setState({values:c.state.values.slice(0,-1)}))}),_defineProperty(_assertThisInitialized(c),"renderDropdown",function(){return c.props.portal?_reactDom.default.createPortal(_react.default.createElement(_Dropdown.default,{props:c.props,state:c.state,methods:c.methods}),c.dropdownRoot):_react.default.createElement(_Dropdown.default,{props:c.props,state:c.state,methods:c.methods})}),_defineProperty(_assertThisInitialized(c),"createNew",function(a){var b,d=(b={},b[c.props.labelField]=a,b[c.props.valueField]=a,b);c.addItem(d),c.props.onCreateNew(d),c.setState({search:""})}),c.state={dropdown:!1,values:b.values,search:"",selectBounds:{},cursor:null},c.methods={removeItem:c.removeItem,dropDown:c.dropDown,addItem:c.addItem,setSearch:c.setSearch,getInputSize:c.getInputSize,toggleSelectAll:c.toggleSelectAll,clearAll:c.clearAll,selectAll:c.selectAll,searchResults:c.searchResults,getSelectRef:c.getSelectRef,isSelected:c.isSelected,getSelectBounds:c.getSelectBounds,areAllSelected:c.areAllSelected,handleKeyDown:c.handleKeyDown,activeCursorItem:c.activeCursorItem,createNew:c.createNew,sortBy:c.sortBy,safeString:c.safeString},c.select=_react.default.createRef(),c.dropdownRoot="undefined"!=typeof document&&document.createElement("div"),c}_inheritsLoose(b,a);var c=b.prototype;return c.componentDidMount=function componentDidMount(){this.props.portal&&this.props.portal.appendChild(this.dropdownRoot),(0,_util.isomorphicWindow)().addEventListener("resize",(0,_util.debounce)(this.updateSelectBounds)),this.props.scrollContainer?this.props.scrollContainer.addEventListener("scroll",(0,_util.debounce)(this.onScroll)):(0,_util.isomorphicWindow)().addEventListener("scroll",(0,_util.debounce)(this.onScroll)),this.dropDown("close"),this.select&&this.updateSelectBounds()},c.componentDidUpdate=function componentDidUpdate(a,b){var c=this;!(0,_util.isEqual)(a.values,this.props.values)&&(0,_util.isEqual)(a.values,b.values)&&(this.setState({values:this.props.values},function(){c.props.onChange(c.state.values)}),this.updateSelectBounds()),b.values!==this.state.values&&(this.props.onChange(this.state.values),this.updateSelectBounds()),b.search!==this.state.search&&this.updateSelectBounds(),b.values!==this.state.values&&this.props.closeOnSelect&&this.dropDown("close"),a.multi!==this.props.multi&&this.updateSelectBounds(),b.dropdown&&b.dropdown!==this.state.dropdown&&this.onDropdownClose(),b.dropdown||b.dropdown===this.state.dropdown||this.props.onDropdownOpen(),this.props.portal&&a.portal!==this.props.portal&&this.props.portal&&this.props.portal.appendChild(this.dropdownRoot),!this.props.portal&&a.portal!==this.props.portal&&this.props.portal&&this.props.portal.removeChild(this.dropdownRoot),this.props.scrollContainer&&a.scrollContainer!==this.props.scrollContainer&&(this.props.scrollContainer.addEventListener("scroll",(0,_util.debounce)(this.onScroll)),(0,_util.isomorphicWindow)().removeEventListener("scroll",(0,_util.debounce)(this.onScroll,this.props.debounceDelay))),this.props.scrollContainer||a.scrollContainer===this.props.scrollContainer||(this.props.scrollContainer.removeEventListener("scroll",(0,_util.debounce)(this.onScroll)),(0,_util.isomorphicWindow)().addEventListener("scroll",(0,_util.debounce)(this.onScroll)))},c.componentWillUnmount=function componentWillUnmount(){this.props.portal&&this.props.portal.removeChild(this.dropdownRoot),(0,_util.isomorphicWindow)().removeEventListener("resize",(0,_util.debounce)(this.updateSelectBounds,this.props.debounceDelay)),this.props.scrollContainer?this.props.scrollContainer.removeEventListener("scroll",(0,_util.debounce)(this.onScroll,this.props.debounceDelay)):(0,_util.isomorphicWindow)().removeEventListener("scroll",(0,_util.debounce)(this.onScroll,this.props.debounceDelay))},c.render=function render(){var a=this;return _react.default.createElement(_ClickOutside.default,{onClickOutside:function onClickOutside(b){return a.dropDown("close",b)}},_react.default.createElement(ReactDropdownSelect,_extends({onKeyDown:this.handleKeyDown,onClick:function onClick(b){return a.dropDown("open",b)},onFocus:function onFocus(b){return a.dropDown("open",b)},tabIndex:this.props.disabled?"-1":"0",direction:this.props.direction,style:this.props.style,ref:this.select,disabled:this.props.disabled,className:_constants.LIB_NAME+" "+this.props.className,color:this.props.color},this.props.additionalProps),_react.default.createElement(_Content.default,{props:this.props,state:this.state,methods:this.methods}),(this.props.name||this.props.required)&&_react.default.createElement("input",{tabIndex:-1,style:{opacity:0,width:0,position:"absolute"},name:this.props.name,required:this.props.required,pattern:this.props.pattern,value:this.state.values.map(function(b){return b[a.props.labelField]}).toString()||[],disabled:this.props.disabled}),this.props.loading&&_react.default.createElement(_Loading.default,{props:this.props}),this.props.clearable&&_react.default.createElement(_Clear.default,{props:this.props,state:this.state,methods:this.methods}),this.props.separator&&_react.default.createElement(_Separator.default,{props:this.props,state:this.state,methods:this.methods}),this.props.dropdownHandle&&_react.default.createElement(_DropdownHandle.default,{onClick:function onClick(){return a.select.current.focus()},props:this.props,state:this.state,methods:this.methods}),this.state.dropdown&&!this.props.disabled&&this.renderDropdown()))},b}(_react.Component);exports.Select=Select,Select.defaultProps={addPlaceholder:"",placeholder:"Select...",values:[],options:[],multi:!1,disabled:!1,searchBy:"label",sortBy:null,clearable:!1,searchable:!0,dropdownHandle:!0,separator:!1,keepOpen:void 0,noDataLabel:"No data",createNewLabel:"add {search}",disabledLabel:"disabled",dropdownGap:5,closeOnScroll:!1,debounceDelay:0,labelField:"label",valueField:"value",color:"#0074D9",keepSelectedInList:!0,closeOnSelect:!1,clearOnBlur:!0,clearOnSelect:!0,dropdownPosition:"bottom",dropdownHeight:"300px",autoFocus:!1,portal:null,create:!1,direction:"ltr",name:null,required:!1,pattern:!1,onChange:function onChange(){},onDropdownOpen:function onDropdownOpen(){},onDropdownClose:function onDropdownClose(){},onClearAll:function onClearAll(){},onSelectAll:function onSelectAll(){},onCreateNew:function onCreateNew(){},searchFn:function searchFn(){},handleKeyDownFn:function handleKeyDownFn(){},additionalProps:null,backspaceDelete:!0};var ReactDropdownSelect=(0,_styledBase.default)("div",{target:"e1gzf2xs0",label:"ReactDropdownSelect"})("position:relative;display:flex;border:1px solid #ccc;width:100%;border-radius:2px;padding:2px 5px;flex-direction:row;direction:",function(a){var b=a.direction;return b},";align-items:center;cursor:pointer;min-height:36px;",function(a){var b=a.disabled;return b?"cursor: not-allowed;pointer-events: none;opacity: 0.3;":"pointer-events: all;"},":hover,:focus-within{border-color:",function(a){var b=a.color;return b},";}:focus,:focus-within{outline:0;box-shadow:0 0 0 3px ",function(a){var b=a.color;return(0,_util.hexToRGBA)(b,.2)},";}"+("production"===process.env.NODE_ENV?"":"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFza0JzQyIsImZpbGUiOiIuLi9zcmMvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcclxuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcclxuaW1wb3J0IHN0eWxlZCBmcm9tICdAZW1vdGlvbi9zdHlsZWQnO1xyXG5pbXBvcnQgQ2xpY2tPdXRzaWRlIGZyb20gJy4vY29tcG9uZW50cy9DbGlja091dHNpZGUnO1xyXG5cclxuaW1wb3J0IENvbnRlbnQgZnJvbSAnLi9jb21wb25lbnRzL0NvbnRlbnQnO1xyXG5pbXBvcnQgRHJvcGRvd24gZnJvbSAnLi9jb21wb25lbnRzL0Ryb3Bkb3duJztcclxuaW1wb3J0IExvYWRpbmcgZnJvbSAnLi9jb21wb25lbnRzL0xvYWRpbmcnO1xyXG5pbXBvcnQgQ2xlYXIgZnJvbSAnLi9jb21wb25lbnRzL0NsZWFyJztcclxuaW1wb3J0IFNlcGFyYXRvciBmcm9tICcuL2NvbXBvbmVudHMvU2VwYXJhdG9yJztcclxuaW1wb3J0IERyb3Bkb3duSGFuZGxlIGZyb20gJy4vY29tcG9uZW50cy9Ecm9wZG93bkhhbmRsZSc7XHJcblxyXG5pbXBvcnQgeyBkZWJvdW5jZSwgaGV4VG9SR0JBLCBpc0VxdWFsLCBnZXRCeVBhdGgsIGdldFByb3AsIHZhbHVlRXhpc3RJblNlbGVjdGVkLCBpc29tb3JwaGljV2luZG93IH0gZnJvbSAnLi91dGlsJztcclxuaW1wb3J0IHsgTElCX05BTUUgfSBmcm9tICcuL2NvbnN0YW50cyc7XHJcblxyXG5leHBvcnQgY2xhc3MgU2VsZWN0IGV4dGVuZHMgQ29tcG9uZW50IHtcclxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xyXG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXHJcbiAgICBvbkRyb3Bkb3duQ2xvc2U6IFByb3BUeXBlcy5mdW5jLFxyXG4gICAgb25Ecm9wZG93bk9wZW46IFByb3BUeXBlcy5mdW5jLFxyXG4gICAgb25DbGVhckFsbDogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBvblNlbGVjdEFsbDogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICB2YWx1ZXM6IFByb3BUeXBlcy5hcnJheSxcclxuICAgIG9wdGlvbnM6IFByb3BUeXBlcy5hcnJheS5pc1JlcXVpcmVkLFxyXG4gICAga2VlcE9wZW46IFByb3BUeXBlcy5ib29sLFxyXG4gICAgZHJvcGRvd25HYXA6IFByb3BUeXBlcy5udW1iZXIsXHJcbiAgICBtdWx0aTogUHJvcFR5cGVzLmJvb2wsXHJcbiAgICBwbGFjZWhvbGRlcjogUHJvcFR5cGVzLnN0cmluZyxcclxuICAgIGFkZFBsYWNlaG9sZGVyOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gICAgbG9hZGluZzogUHJvcFR5cGVzLmJvb2wsXHJcbiAgICBjbGVhcmFibGU6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgc2VhcmNoYWJsZTogUHJvcFR5cGVzLmJvb2wsXHJcbiAgICBzZXBhcmF0b3I6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgZHJvcGRvd25IYW5kbGU6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgc2VhcmNoQnk6IFByb3BUeXBlcy5zdHJpbmcsXHJcbiAgICBzb3J0Qnk6IFByb3BUeXBlcy5zdHJpbmcsXHJcbiAgICBjbG9zZU9uU2Nyb2xsOiBQcm9wVHlwZXMuYm9vbCxcclxuICAgIG9wZW5PblRvcDogUHJvcFR5cGVzLmJvb2wsXHJcbiAgICBzdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcclxuICAgIGNvbnRlbnRSZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBkcm9wZG93blJlbmRlcmVyOiBQcm9wVHlwZXMuZnVuYyxcclxuICAgIGl0ZW1SZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBub0RhdGFSZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBvcHRpb25SZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBpbnB1dFJlbmRlcmVyOiBQcm9wVHlwZXMuZnVuYyxcclxuICAgIGxvYWRpbmdSZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMsXHJcbiAgICBjbGVhclJlbmRlcmVyOiBQcm9wVHlwZXMuZnVuYyxcclxuICAgIHNlcGFyYXRvclJlbmRlcmVyOiBQcm9wVHlwZXMuZnVuYyxcclxuICAgIGRyb3Bkb3duSGFuZGxlUmVuZGVyZXI6IFByb3BUeXBlcy5mdW5jLFxyXG4gICAgZGlyZWN0aW9uOiBQcm9wVHlwZXMuc3RyaW5nLFxyXG4gICAgcmVxdWlyZWQ6IFByb3BUeXBlcy5ib29sLFxyXG4gICAgcGF0dGVybjogUHJvcFR5cGVzLnN0cmluZyxcclxuICAgIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXHJcbiAgICBiYWNrc3BhY2VEZWxldGU6IFByb3BUeXBlcy5ib29sXHJcbiAgfTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcclxuICAgIHN1cGVyKHByb3BzKTtcclxuXHJcbiAgICB0aGlzLnN0YXRlID0ge1xyXG4gICAgICBkcm9wZG93bjogZmFsc2UsXHJcbiAgICAgIHZhbHVlczogcHJvcHMudmFsdWVzLFxyXG4gICAgICBzZWFyY2g6ICcnLFxyXG4gICAgICBzZWxlY3RCb3VuZHM6IHt9LFxyXG4gICAgICBjdXJzb3I6IG51bGxcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5tZXRob2RzID0ge1xyXG4gICAgICByZW1vdmVJdGVtOiB0aGlzLnJlbW92ZUl0ZW0sXHJcbiAgICAgIGRyb3BEb3duOiB0aGlzLmRyb3BEb3duLFxyXG4gICAgICBhZGRJdGVtOiB0aGlzLmFkZEl0ZW0sXHJcbiAgICAgIHNldFNlYXJjaDogdGhpcy5zZXRTZWFyY2gsXHJcbiAgICAgIGdldElucHV0U2l6ZTogdGhpcy5nZXRJbnB1dFNpemUsXHJcbiAgICAgIHRvZ2dsZVNlbGVjdEFsbDogdGhpcy50b2dnbGVTZWxlY3RBbGwsXHJcbiAgICAgIGNsZWFyQWxsOiB0aGlzLmNsZWFyQWxsLFxyXG4gICAgICBzZWxlY3RBbGw6IHRoaXMuc2VsZWN0QWxsLFxyXG4gICAgICBzZWFyY2hSZXN1bHRzOiB0aGlzLnNlYXJjaFJlc3VsdHMsXHJcbiAgICAgIGdldFNlbGVjdFJlZjogdGhpcy5nZXRTZWxlY3RSZWYsXHJcbiAgICAgIGlzU2VsZWN0ZWQ6IHRoaXMuaXNTZWxlY3RlZCxcclxuICAgICAgZ2V0U2VsZWN0Qm91bmRzOiB0aGlzLmdldFNlbGVjdEJvdW5kcyxcclxuICAgICAgYXJlQWxsU2VsZWN0ZWQ6IHRoaXMuYXJlQWxsU2VsZWN0ZWQsXHJcbiAgICAgIGhhbmRsZUtleURvd246IHRoaXMuaGFuZGxlS2V5RG93bixcclxuICAgICAgYWN0aXZlQ3Vyc29ySXRlbTogdGhpcy5hY3RpdmVDdXJzb3JJdGVtLFxyXG4gICAgICBjcmVhdGVOZXc6IHRoaXMuY3JlYXRlTmV3LFxyXG4gICAgICBzb3J0Qnk6IHRoaXMuc29ydEJ5LFxyXG4gICAgICBzYWZlU3RyaW5nOiB0aGlzLnNhZmVTdHJpbmdcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5zZWxlY3QgPSBSZWFjdC5jcmVhdGVSZWYoKTtcclxuICAgIHRoaXMuZHJvcGRvd25Sb290ID0gdHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xyXG4gICAgdGhpcy5wcm9wcy5wb3J0YWwgJiYgdGhpcy5wcm9wcy5wb3J0YWwuYXBwZW5kQ2hpbGQodGhpcy5kcm9wZG93blJvb3QpO1xyXG4gICAgaXNvbW9ycGhpY1dpbmRvdygpLmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGRlYm91bmNlKHRoaXMudXBkYXRlU2VsZWN0Qm91bmRzKSk7XHJcbiAgICBcclxuICAgIGlmICh0aGlzLnByb3BzLnNjcm9sbENvbnRhaW5lcikge1xyXG4gICAgICB0aGlzLnByb3BzLnNjcm9sbENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBkZWJvdW5jZSh0aGlzLm9uU2Nyb2xsKSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpc29tb3JwaGljV2luZG93KCkuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgZGVib3VuY2UodGhpcy5vblNjcm9sbCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZHJvcERvd24oJ2Nsb3NlJyk7XHJcblxyXG4gICAgaWYgKHRoaXMuc2VsZWN0KSB7XHJcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0Qm91bmRzKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzLCBwcmV2U3RhdGUpIHtcclxuICAgIGlmIChcclxuICAgICAgIWlzRXF1YWwocHJldlByb3BzLnZhbHVlcywgdGhpcy5wcm9wcy52YWx1ZXMpICYmXHJcbiAgICAgIGlzRXF1YWwocHJldlByb3BzLnZhbHVlcywgcHJldlN0YXRlLnZhbHVlcylcclxuICAgICkge1xyXG4gICAgICB0aGlzLnNldFN0YXRlKHtcclxuICAgICAgICB2YWx1ZXM6IHRoaXMucHJvcHMudmFsdWVzXHJcbiAgICAgIH0sICgpID0+IHtcclxuICAgICAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKHRoaXMuc3RhdGUudmFsdWVzKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0Qm91bmRzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHByZXZTdGF0ZS52YWx1ZXMgIT09IHRoaXMuc3RhdGUudmFsdWVzKSB7XHJcbiAgICAgIHRoaXMucHJvcHMub25DaGFuZ2UodGhpcy5zdGF0ZS52YWx1ZXMpO1xyXG4gICAgICB0aGlzLnVwZGF0ZVNlbGVjdEJvdW5kcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChwcmV2U3RhdGUuc2VhcmNoICE9PSB0aGlzLnN0YXRlLnNlYXJjaCkge1xyXG4gICAgICB0aGlzLnVwZGF0ZVNlbGVjdEJvdW5kcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChwcmV2U3RhdGUudmFsdWVzICE9PSB0aGlzLnN0YXRlLnZhbHVlcyAmJiB0aGlzLnByb3BzLmNsb3NlT25TZWxlY3QpIHtcclxuICAgICAgdGhpcy5kcm9wRG93bignY2xvc2UnKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocHJldlByb3BzLm11bHRpICE9PSB0aGlzLnByb3BzLm11bHRpKSB7XHJcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0Qm91bmRzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHByZXZTdGF0ZS5kcm9wZG93biAmJiBwcmV2U3RhdGUuZHJvcGRvd24gIT09IHRoaXMuc3RhdGUuZHJvcGRvd24pIHtcclxuICAgICAgdGhpcy5vbkRyb3Bkb3duQ2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXByZXZTdGF0ZS5kcm9wZG93biAmJiBwcmV2U3RhdGUuZHJvcGRvd24gIT09IHRoaXMuc3RhdGUuZHJvcGRvd24pIHtcclxuICAgICAgdGhpcy5wcm9wcy5vbkRyb3Bkb3duT3BlbigpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLnByb3BzLnBvcnRhbCAmJiBwcmV2UHJvcHMucG9ydGFsICE9PSB0aGlzLnByb3BzLnBvcnRhbCkge1xyXG4gICAgICB0aGlzLnByb3BzLnBvcnRhbCAmJiB0aGlzLnByb3BzLnBvcnRhbC5hcHBlbmRDaGlsZCh0aGlzLmRyb3Bkb3duUm9vdCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCF0aGlzLnByb3BzLnBvcnRhbCAmJiBwcmV2UHJvcHMucG9ydGFsICE9PSB0aGlzLnByb3BzLnBvcnRhbCkge1xyXG4gICAgICB0aGlzLnByb3BzLnBvcnRhbCAmJiB0aGlzLnByb3BzLnBvcnRhbC5yZW1vdmVDaGlsZCh0aGlzLmRyb3Bkb3duUm9vdCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMucHJvcHMuc2Nyb2xsQ29udGFpbmVyICYmIHByZXZQcm9wcy5zY3JvbGxDb250YWluZXIgIT09IHRoaXMucHJvcHMuc2Nyb2xsQ29udGFpbmVyKSAge1xyXG4gICAgICB0aGlzLnByb3BzLnNjcm9sbENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBkZWJvdW5jZSh0aGlzLm9uU2Nyb2xsKSk7XHJcbiAgICAgIGlzb21vcnBoaWNXaW5kb3coKS5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBkZWJvdW5jZSh0aGlzLm9uU2Nyb2xsLCB0aGlzLnByb3BzLmRlYm91bmNlRGVsYXkpKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXRoaXMucHJvcHMuc2Nyb2xsQ29udGFpbmVyICYmIHByZXZQcm9wcy5zY3JvbGxDb250YWluZXIgIT09IHRoaXMucHJvcHMuc2Nyb2xsQ29udGFpbmVyKSAge1xyXG4gICAgICB0aGlzLnByb3BzLnNjcm9sbENvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBkZWJvdW5jZSh0aGlzLm9uU2Nyb2xsKSk7XHJcbiAgICAgIGlzb21vcnBoaWNXaW5kb3coKS5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBkZWJvdW5jZSh0aGlzLm9uU2Nyb2xsKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcclxuICAgIHRoaXMucHJvcHMucG9ydGFsICYmIHRoaXMucHJvcHMucG9ydGFsLnJlbW92ZUNoaWxkKHRoaXMuZHJvcGRvd25Sb290KTtcclxuICAgIGlzb21vcnBoaWNXaW5kb3coKS5yZW1vdmVFdmVudExpc3RlbmVyKFxyXG4gICAgICAncmVzaXplJyxcclxuICAgICAgZGVib3VuY2UodGhpcy51cGRhdGVTZWxlY3RCb3VuZHMsIHRoaXMucHJvcHMuZGVib3VuY2VEZWxheSlcclxuICAgICk7XHJcblxyXG4gICAgaWYgKHRoaXMucHJvcHMuc2Nyb2xsQ29udGFpbmVyKSB7XHJcbiAgICAgIHRoaXMucHJvcHMuc2Nyb2xsQ29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGRlYm91bmNlKHRoaXMub25TY3JvbGwsIHRoaXMucHJvcHMuZGVib3VuY2VEZWxheSkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaXNvbW9ycGhpY1dpbmRvdygpLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGRlYm91bmNlKHRoaXMub25TY3JvbGwsIHRoaXMucHJvcHMuZGVib3VuY2VEZWxheSkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb25Ecm9wZG93bkNsb3NlID0gKCkgPT4ge1xyXG4gICAgdGhpcy5zZXRTdGF0ZSh7IGN1cnNvcjogbnVsbCB9KTtcclxuICAgIHRoaXMucHJvcHMub25Ecm9wZG93bkNsb3NlKCk7XHJcbiAgfTtcclxuXHJcbiAgb25TY3JvbGwgPSAoKSA9PiB7XHJcbiAgICBpZiAodGhpcy5wcm9wcy5jbG9zZU9uU2Nyb2xsKSB7XHJcbiAgICAgIHRoaXMuZHJvcERvd24oJ2Nsb3NlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy51cGRhdGVTZWxlY3RCb3VuZHMoKTtcclxuICB9O1xyXG5cclxuICB1cGRhdGVTZWxlY3RCb3VuZHMgPSAoKSA9PlxyXG4gICAgdGhpcy5zZWxlY3QuY3VycmVudCAmJlxyXG4gICAgdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgIHNlbGVjdEJvdW5kczogdGhpcy5zZWxlY3QuY3VycmVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxyXG4gICAgfSk7XHJcblxyXG4gIGdldFNlbGVjdEJvdW5kcyA9ICgpID0+IHRoaXMuc3RhdGUuc2VsZWN0Qm91bmRzO1xyXG5cclxuICBkcm9wRG93biA9IChhY3Rpb24gPSAndG9nZ2xlJywgZXZlbnQpID0+IHtcclxuICAgIGNvbnN0IHRhcmdldCA9IChldmVudCAmJiBldmVudC50YXJnZXQpIHx8IChldmVudCAmJiBldmVudC5zcmNFbGVtZW50KTtcclxuXHJcbiAgICBpZiAoXHJcbiAgICAgIHRoaXMucHJvcHMucG9ydGFsICYmXHJcbiAgICAgICF0aGlzLnByb3BzLmNsb3NlT25TY3JvbGwgJiZcclxuICAgICAgIXRoaXMucHJvcHMuY2xvc2VPblNlbGVjdCAmJlxyXG4gICAgICBldmVudCAmJlxyXG4gICAgICB0YXJnZXQgJiZcclxuICAgICAgdGFyZ2V0Lm9mZnNldFBhcmVudCAmJlxyXG4gICAgICB0YXJnZXQub2Zmc2V0UGFyZW50LmNsYXNzTGlzdC5jb250YWlucygncmVhY3QtZHJvcGRvd24tc2VsZWN0LWRyb3Bkb3duJylcclxuICAgICkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMucHJvcHMua2VlcE9wZW4pIHtcclxuICAgICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUoeyBkcm9wZG93bjogdHJ1ZSB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYWN0aW9uID09PSAnY2xvc2UnICYmIHRoaXMuc3RhdGUuZHJvcGRvd24pIHtcclxuICAgICAgdGhpcy5zZWxlY3QuY3VycmVudC5ibHVyKCk7XHJcblxyXG4gICAgICByZXR1cm4gdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgZHJvcGRvd246IGZhbHNlLFxyXG4gICAgICAgIHNlYXJjaDogdGhpcy5wcm9wcy5jbGVhck9uQmx1ciA/ICcnIDogdGhpcy5zdGF0ZS5zZWFyY2hcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGFjdGlvbiA9PT0gJ29wZW4nICYmICF0aGlzLnN0YXRlLmRyb3Bkb3duKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnNldFN0YXRlKHsgZHJvcGRvd246IHRydWUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGFjdGlvbiA9PT0gJ3RvZ2dsZScpIHtcclxuICAgICAgdGhpcy5zZWxlY3QuY3VycmVudC5mb2N1cygpO1xyXG4gICAgICByZXR1cm4gdGhpcy5zZXRTdGF0ZSh7IGRyb3Bkb3duOiAhdGhpcy5zdGF0ZS5kcm9wZG93biB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfTtcclxuXHJcbiAgZ2V0U2VsZWN0UmVmID0gKCkgPT4gdGhpcy5zZWxlY3QuY3VycmVudDtcclxuXHJcbiAgYWRkSXRlbSA9IChpdGVtKSA9PiB7XHJcbiAgICBpZiAodGhpcy5wcm9wcy5tdWx0aSkge1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgdmFsdWVFeGlzdEluU2VsZWN0ZWQoZ2V0QnlQYXRoKGl0ZW0sIHRoaXMucHJvcHMudmFsdWVGaWVsZCksIHRoaXMuc3RhdGUudmFsdWVzLCB0aGlzLnByb3BzKVxyXG4gICAgICApIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZW1vdmVJdGVtKG51bGwsIGl0ZW0sIGZhbHNlKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgdmFsdWVzOiBbLi4udGhpcy5zdGF0ZS52YWx1ZXMsIGl0ZW1dXHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgdmFsdWVzOiBbaXRlbV0sXHJcbiAgICAgICAgZHJvcGRvd246IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMucHJvcHMuY2xlYXJPblNlbGVjdCAmJiB0aGlzLnNldFN0YXRlKHsgc2VhcmNoOiAnJyB9KTtcclxuXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9O1xyXG5cclxuICByZW1vdmVJdGVtID0gKGV2ZW50LCBpdGVtLCBjbG9zZSA9IGZhbHNlKSA9PiB7XHJcbiAgICBpZiAoZXZlbnQgJiYgY2xvc2UpIHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgIHRoaXMuZHJvcERvd24oJ2Nsb3NlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgIHZhbHVlczogdGhpcy5zdGF0ZS52YWx1ZXMuZmlsdGVyKFxyXG4gICAgICAgICh2YWx1ZXMpID0+XHJcbiAgICAgICAgICBnZXRCeVBhdGgodmFsdWVzLCB0aGlzLnByb3BzLnZhbHVlRmllbGQpICE9PSBnZXRCeVBhdGgoaXRlbSwgdGhpcy5wcm9wcy52YWx1ZUZpZWxkKVxyXG4gICAgICApXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBzZXRTZWFyY2ggPSAoZXZlbnQpID0+IHtcclxuICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICBjdXJzb3I6IG51bGxcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICBzZWFyY2g6IGV2ZW50LnRhcmdldC52YWx1ZVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgZ2V0SW5wdXRTaXplID0gKCkgPT4ge1xyXG4gICAgaWYgKHRoaXMuc3RhdGUuc2VhcmNoKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnN0YXRlLnNlYXJjaC5sZW5ndGg7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuc3RhdGUudmFsdWVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgcmV0dXJuIHRoaXMucHJvcHMuYWRkUGxhY2Vob2xkZXIubGVuZ3RoO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLnByb3BzLnBsYWNlaG9sZGVyLmxlbmd0aDtcclxuICB9O1xyXG5cclxuICB0b2dnbGVTZWxlY3RBbGwgPSAoKSA9PiB7XHJcbiAgICByZXR1cm4gdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgIHZhbHVlczogdGhpcy5zdGF0ZS52YWx1ZXMubGVuZ3RoID09PSAwID8gdGhpcy5zZWxlY3RBbGwoKSA6IHRoaXMuY2xlYXJBbGwoKVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgY2xlYXJBbGwgPSAoKSA9PiB7XHJcbiAgICB0aGlzLnByb3BzLm9uQ2xlYXJBbGwoKTtcclxuICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICB2YWx1ZXM6IFtdXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBzZWxlY3RBbGwgPSAodmFsdWVzTGlzdD1bXSkgPT4ge1xyXG4gICAgdGhpcy5wcm9wcy5vblNlbGVjdEFsbCgpO1xyXG4gICAgY29uc3QgdmFsdWVzID0gdmFsdWVzTGlzdC5sZW5ndGggPiAwXHJcbiAgICAgID8gdmFsdWVzTGlzdFxyXG4gICAgICA6IHRoaXMucHJvcHMub3B0aW9ucy5maWx0ZXIoKG9wdGlvbikgPT4gIW9wdGlvbi5kaXNhYmxlZCk7XHJcblxyXG4gICAgdGhpcy5zZXRTdGF0ZSh7IHZhbHVlcyB9KTtcclxuICB9O1xyXG5cclxuICBpc1NlbGVjdGVkID0gKG9wdGlvbikgPT5cclxuICAgICEhdGhpcy5zdGF0ZS52YWx1ZXMuZmluZChcclxuICAgICAgKHZhbHVlKSA9PlxyXG4gICAgICAgIGdldEJ5UGF0aCh2YWx1ZSwgdGhpcy5wcm9wcy52YWx1ZUZpZWxkKSA9PT0gZ2V0QnlQYXRoKG9wdGlvbiwgdGhpcy5wcm9wcy52YWx1ZUZpZWxkKVxyXG4gICAgKTtcclxuXHJcbiAgYXJlQWxsU2VsZWN0ZWQgPSAoKSA9PlxyXG4gICAgdGhpcy5zdGF0ZS52YWx1ZXMubGVuZ3RoID09PSB0aGlzLnByb3BzLm9wdGlvbnMuZmlsdGVyKChvcHRpb24pID0+ICFvcHRpb24uZGlzYWJsZWQpLmxlbmd0aDtcclxuXHJcbiAgc2FmZVN0cmluZyA9IChzdHJpbmcpID0+IHN0cmluZy5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgJ1xcXFwkJicpO1xyXG5cclxuICBzb3J0QnkgPSAoKSA9PiB7XHJcbiAgICBjb25zdCB7IHNvcnRCeSwgb3B0aW9ucyB9ID0gdGhpcy5wcm9wcztcclxuXHJcbiAgICBpZiAoIXNvcnRCeSkge1xyXG4gICAgICByZXR1cm4gb3B0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICBvcHRpb25zLnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgaWYgKGdldFByb3AoYSwgc29ydEJ5KSA8IGdldFByb3AoYiwgc29ydEJ5KSkge1xyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgICAgfSBlbHNlIGlmIChnZXRQcm9wKGEsIHNvcnRCeSkgPiBnZXRQcm9wKGIsIHNvcnRCeSkpIHtcclxuICAgICAgICByZXR1cm4gMTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIG9wdGlvbnM7XHJcbiAgfTtcclxuXHJcbiAgc2VhcmNoRm4gPSAoeyBzdGF0ZSwgbWV0aG9kcyB9KSA9PiB7XHJcbiAgICBjb25zdCByZWdleHAgPSBuZXcgUmVnRXhwKG1ldGhvZHMuc2FmZVN0cmluZyhzdGF0ZS5zZWFyY2gpLCAnaScpO1xyXG5cclxuICAgIHJldHVybiBtZXRob2RzXHJcbiAgICAgIC5zb3J0QnkoKVxyXG4gICAgICAuZmlsdGVyKChpdGVtKSA9PlxyXG4gICAgICAgIHJlZ2V4cC50ZXN0KGdldEJ5UGF0aChpdGVtLCB0aGlzLnByb3BzLnNlYXJjaEJ5KSB8fCBnZXRCeVBhdGgoaXRlbSwgdGhpcy5wcm9wcy52YWx1ZUZpZWxkKSlcclxuICAgICAgKTtcclxuICB9O1xyXG5cclxuICBzZWFyY2hSZXN1bHRzID0gKCkgPT4ge1xyXG4gICAgY29uc3QgYXJncyA9IHsgc3RhdGU6IHRoaXMuc3RhdGUsIHByb3BzOiB0aGlzLnByb3BzLCBtZXRob2RzOiB0aGlzLm1ldGhvZHMgfTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5zZWFyY2hGbihhcmdzKSB8fCB0aGlzLnNlYXJjaEZuKGFyZ3MpO1xyXG4gIH07XHJcblxyXG4gIGFjdGl2ZUN1cnNvckl0ZW0gPSAoYWN0aXZlQ3Vyc29ySXRlbSkgPT5cclxuICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICBhY3RpdmVDdXJzb3JJdGVtXHJcbiAgICB9KTtcclxuXHJcbiAgaGFuZGxlS2V5RG93biA9IChldmVudCkgPT4ge1xyXG4gICAgY29uc3QgYXJncyA9IHtcclxuICAgICAgZXZlbnQsXHJcbiAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxyXG4gICAgICBwcm9wczogdGhpcy5wcm9wcyxcclxuICAgICAgbWV0aG9kczogdGhpcy5tZXRob2RzLFxyXG4gICAgICBzZXRTdGF0ZTogdGhpcy5zZXRTdGF0ZS5iaW5kKHRoaXMpXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB0aGlzLnByb3BzLmhhbmRsZUtleURvd25GbihhcmdzKSB8fCB0aGlzLmhhbmRsZUtleURvd25GbihhcmdzKTtcclxuICB9O1xyXG5cclxuICBoYW5kbGVLZXlEb3duRm4gPSAoeyBldmVudCwgc3RhdGUsIHByb3BzLCBtZXRob2RzLCBzZXRTdGF0ZSB9KSA9PiB7XHJcbiAgICBjb25zdCB7IGN1cnNvciB9ID0gc3RhdGU7XHJcbiAgICBjb25zdCBlc2NhcGUgPSBldmVudC5rZXkgPT09ICdFc2NhcGUnO1xyXG4gICAgY29uc3QgZW50ZXIgPSBldmVudC5rZXkgPT09ICdFbnRlcic7XHJcbiAgICBjb25zdCBhcnJvd1VwID0gZXZlbnQua2V5ID09PSAnQXJyb3dVcCc7XHJcbiAgICBjb25zdCBhcnJvd0Rvd24gPSBldmVudC5rZXkgPT09ICdBcnJvd0Rvd24nO1xyXG4gICAgY29uc3QgYmFja3NwYWNlID0gZXZlbnQua2V5ID09PSAnQmFja3NwYWNlJztcclxuICAgICAgY29uc3QgdGFiID0gZXZlbnQua2V5ID09PSAnVGFiJyAmJiAhZXZlbnQuc2hpZnRLZXk7XHJcbiAgICBjb25zdCBzaGlmdFRhYiA9IGV2ZW50LnNoaWZ0S2V5ICYmIGV2ZW50LmtleSA9PT0gJ1RhYic7XHJcblxyXG4gICAgaWYgKChhcnJvd0Rvd24gfHwgdGFiKSAmJiBjdXJzb3IgPT09IG51bGwpIHtcclxuICAgICAgcmV0dXJuIHNldFN0YXRlKHtcclxuICAgICAgICBjdXJzb3I6IDBcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGFycm93VXAgfHwgYXJyb3dEb3duIHx8IHNoaWZ0VGFiIHx8IHRhYikge1xyXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChlc2NhcGUpIHtcclxuICAgICAgdGhpcy5kcm9wRG93bignY2xvc2UnKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZW50ZXIpIHtcclxuICAgICAgY29uc3QgY3VycmVudEl0ZW0gPSBtZXRob2RzLnNlYXJjaFJlc3VsdHMoKVtjdXJzb3JdO1xyXG4gICAgICBpZiAoY3VycmVudEl0ZW0gJiYgIWN1cnJlbnRJdGVtLmRpc2FibGVkKSB7XHJcbiAgICAgICAgaWYgKHByb3BzLmNyZWF0ZSAmJiB2YWx1ZUV4aXN0SW5TZWxlY3RlZChzdGF0ZS5zZWFyY2gsIHN0YXRlLnZhbHVlcywgcHJvcHMpKSB7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG1ldGhvZHMuYWRkSXRlbShjdXJyZW50SXRlbSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoKGFycm93RG93biB8fCB0YWIpICYmIG1ldGhvZHMuc2VhcmNoUmVzdWx0cygpLmxlbmd0aCA9PT0gY3Vyc29yKSB7XHJcbiAgICAgIHJldHVybiBzZXRTdGF0ZSh7XHJcbiAgICAgICAgY3Vyc29yOiAwXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhcnJvd0Rvd24gfHwgdGFiKSB7XHJcbiAgICAgIHNldFN0YXRlKChwcmV2U3RhdGUpID0+ICh7XHJcbiAgICAgICAgY3Vyc29yOiBwcmV2U3RhdGUuY3Vyc29yICsgMVxyXG4gICAgICB9KSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKChhcnJvd1VwIHx8IHNoaWZ0VGFiKSAmJiBjdXJzb3IgPiAwKSB7XHJcbiAgICAgIHNldFN0YXRlKChwcmV2U3RhdGUpID0+ICh7XHJcbiAgICAgICAgY3Vyc29yOiBwcmV2U3RhdGUuY3Vyc29yIC0gMVxyXG4gICAgICB9KSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKChhcnJvd1VwIHx8IHNoaWZ0VGFiKSAmJiBjdXJzb3IgPT09IDApIHtcclxuICAgICAgc2V0U3RhdGUoe1xyXG4gICAgICAgIGN1cnNvcjogbWV0aG9kcy5zZWFyY2hSZXN1bHRzKCkubGVuZ3RoXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChiYWNrc3BhY2UgJiYgcHJvcHMubXVsdGkgJiYgcHJvcHMuYmFja3NwYWNlRGVsZXRlICYmIHRoaXMuZ2V0SW5wdXRTaXplKCkgPT09IDApIHtcclxuICAgICAgdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgdmFsdWVzOiB0aGlzLnN0YXRlLnZhbHVlcy5zbGljZSgwLCAtMSlcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgcmVuZGVyRHJvcGRvd24gPSAoKSA9PlxyXG4gICAgdGhpcy5wcm9wcy5wb3J0YWwgPyAoXHJcbiAgICAgIFJlYWN0RE9NLmNyZWF0ZVBvcnRhbChcclxuICAgICAgICA8RHJvcGRvd24gcHJvcHM9e3RoaXMucHJvcHN9IHN0YXRlPXt0aGlzLnN0YXRlfSBtZXRob2RzPXt0aGlzLm1ldGhvZHN9IC8+LFxyXG4gICAgICAgIHRoaXMuZHJvcGRvd25Sb290XHJcbiAgICAgIClcclxuICAgICkgOiAoXHJcbiAgICAgIDxEcm9wZG93biBwcm9wcz17dGhpcy5wcm9wc30gc3RhdGU9e3RoaXMuc3RhdGV9IG1ldGhvZHM9e3RoaXMubWV0aG9kc30gLz5cclxuICAgICk7XHJcblxyXG4gIGNyZWF0ZU5ldyA9IChpdGVtKSA9PiB7XHJcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHtcclxuICAgICAgW3RoaXMucHJvcHMubGFiZWxGaWVsZF06IGl0ZW0sXHJcbiAgICAgIFt0aGlzLnByb3BzLnZhbHVlRmllbGRdOiBpdGVtXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuYWRkSXRlbShuZXdWYWx1ZSk7XHJcbiAgICB0aGlzLnByb3BzLm9uQ3JlYXRlTmV3KG5ld1ZhbHVlKTtcclxuICAgIHRoaXMuc2V0U3RhdGUoeyBzZWFyY2g6ICcnIH0pO1xyXG4gIH07XHJcblxyXG4gIHJlbmRlcigpIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIDxDbGlja091dHNpZGUgb25DbGlja091dHNpZGU9eyhldmVudCkgPT4gdGhpcy5kcm9wRG93bignY2xvc2UnLCBldmVudCl9PlxyXG4gICAgICAgIDxSZWFjdERyb3Bkb3duU2VsZWN0XHJcbiAgICAgICAgICBvbktleURvd249e3RoaXMuaGFuZGxlS2V5RG93bn1cclxuICAgICAgICAgIG9uQ2xpY2s9eyhldmVudCkgPT4gdGhpcy5kcm9wRG93bignb3BlbicsIGV2ZW50KX1cclxuICAgICAgICAgIG9uRm9jdXM9eyhldmVudCkgPT4gdGhpcy5kcm9wRG93bignb3BlbicsIGV2ZW50KX1cclxuICAgICAgICAgIHRhYkluZGV4PXt0aGlzLnByb3BzLmRpc2FibGVkID8gJy0xJyA6ICcwJ31cclxuICAgICAgICAgIGRpcmVjdGlvbj17dGhpcy5wcm9wcy5kaXJlY3Rpb259XHJcbiAgICAgICAgICBzdHlsZT17dGhpcy5wcm9wcy5zdHlsZX1cclxuICAgICAgICAgIHJlZj17dGhpcy5zZWxlY3R9XHJcbiAgICAgICAgICBkaXNhYmxlZD17dGhpcy5wcm9wcy5kaXNhYmxlZH1cclxuICAgICAgICAgIGNsYXNzTmFtZT17YCR7TElCX05BTUV9ICR7dGhpcy5wcm9wcy5jbGFzc05hbWV9YH1cclxuICAgICAgICAgIGNvbG9yPXt0aGlzLnByb3BzLmNvbG9yfVxyXG4gICAgICAgICAgey4uLnRoaXMucHJvcHMuYWRkaXRpb25hbFByb3BzfT5cclxuICAgICAgICAgIDxDb250ZW50IHByb3BzPXt0aGlzLnByb3BzfSBzdGF0ZT17dGhpcy5zdGF0ZX0gbWV0aG9kcz17dGhpcy5tZXRob2RzfSAvPlxyXG5cclxuICAgICAgICAgIHsodGhpcy5wcm9wcy5uYW1lIHx8IHRoaXMucHJvcHMucmVxdWlyZWQpICYmIChcclxuICAgICAgICAgICAgPGlucHV0XHJcbiAgICAgICAgICAgICAgdGFiSW5kZXg9ey0xfVxyXG4gICAgICAgICAgICAgIHN0eWxlPXt7IG9wYWNpdHk6IDAsIHdpZHRoOiAwLCBwb3NpdGlvbjogJ2Fic29sdXRlJyB9fVxyXG4gICAgICAgICAgICAgIG5hbWU9e3RoaXMucHJvcHMubmFtZX1cclxuICAgICAgICAgICAgICByZXF1aXJlZD17dGhpcy5wcm9wcy5yZXF1aXJlZH1cclxuICAgICAgICAgICAgICBwYXR0ZXJuPXt0aGlzLnByb3BzLnBhdHRlcm59XHJcbiAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUudmFsdWVzLm1hcCh2YWx1ZSA9PiB2YWx1ZVt0aGlzLnByb3BzLmxhYmVsRmllbGRdKS50b1N0cmluZygpIHx8IFtdfVxyXG4gICAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnByb3BzLmRpc2FibGVkfVxyXG4gICAgICAgICAgICAvPlxyXG4gICAgICAgICAgKX1cclxuXHJcbiAgICAgICAgICB7dGhpcy5wcm9wcy5sb2FkaW5nICYmIDxMb2FkaW5nIHByb3BzPXt0aGlzLnByb3BzfSAvPn1cclxuXHJcbiAgICAgICAgICB7dGhpcy5wcm9wcy5jbGVhcmFibGUgJiYgKFxyXG4gICAgICAgICAgICA8Q2xlYXIgcHJvcHM9e3RoaXMucHJvcHN9IHN0YXRlPXt0aGlzLnN0YXRlfSBtZXRob2RzPXt0aGlzLm1ldGhvZHN9IC8+XHJcbiAgICAgICAgICApfVxyXG5cclxuICAgICAgICAgIHt0aGlzLnByb3BzLnNlcGFyYXRvciAmJiAoXHJcbiAgICAgICAgICAgIDxTZXBhcmF0b3IgcHJvcHM9e3RoaXMucHJvcHN9IHN0YXRlPXt0aGlzLnN0YXRlfSBtZXRob2RzPXt0aGlzLm1ldGhvZHN9IC8+XHJcbiAgICAgICAgICApfVxyXG5cclxuICAgICAgICAgIHt0aGlzLnByb3BzLmRyb3Bkb3duSGFuZGxlICYmIChcclxuICAgICAgICAgICAgPERyb3Bkb3duSGFuZGxlXHJcbiAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gdGhpcy5zZWxlY3QuY3VycmVudC5mb2N1cygpfVxyXG4gICAgICAgICAgICAgIHByb3BzPXt0aGlzLnByb3BzfVxyXG4gICAgICAgICAgICAgIHN0YXRlPXt0aGlzLnN0YXRlfVxyXG4gICAgICAgICAgICAgIG1ldGhvZHM9e3RoaXMubWV0aG9kc31cclxuICAgICAgICAgICAgLz5cclxuICAgICAgICAgICl9XHJcblxyXG4gICAgICAgICAge3RoaXMuc3RhdGUuZHJvcGRvd24gJiYgIXRoaXMucHJvcHMuZGlzYWJsZWQgJiYgdGhpcy5yZW5kZXJEcm9wZG93bigpfVxyXG4gICAgICAgIDwvUmVhY3REcm9wZG93blNlbGVjdD5cclxuICAgICAgPC9DbGlja091dHNpZGU+XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuU2VsZWN0LmRlZmF1bHRQcm9wcyA9IHtcclxuICBhZGRQbGFjZWhvbGRlcjogJycsXHJcbiAgcGxhY2Vob2xkZXI6ICdTZWxlY3QuLi4nLFxyXG4gIHZhbHVlczogW10sXHJcbiAgb3B0aW9uczogW10sXHJcbiAgbXVsdGk6IGZhbHNlLFxyXG4gIGRpc2FibGVkOiBmYWxzZSxcclxuICBzZWFyY2hCeTogJ2xhYmVsJyxcclxuICBzb3J0Qnk6IG51bGwsXHJcbiAgY2xlYXJhYmxlOiBmYWxzZSxcclxuICBzZWFyY2hhYmxlOiB0cnVlLFxyXG4gIGRyb3Bkb3duSGFuZGxlOiB0cnVlLFxyXG4gIHNlcGFyYXRvcjogZmFsc2UsXHJcbiAga2VlcE9wZW46IHVuZGVmaW5lZCxcclxuICBub0RhdGFMYWJlbDogJ05vIGRhdGEnLFxyXG4gIGNyZWF0ZU5ld0xhYmVsOiAnYWRkIHtzZWFyY2h9JyxcclxuICBkaXNhYmxlZExhYmVsOiAnZGlzYWJsZWQnLFxyXG4gIGRyb3Bkb3duR2FwOiA1LFxyXG4gIGNsb3NlT25TY3JvbGw6IGZhbHNlLFxyXG4gIGRlYm91bmNlRGVsYXk6IDAsXHJcbiAgbGFiZWxGaWVsZDogJ2xhYmVsJyxcclxuICB2YWx1ZUZpZWxkOiAndmFsdWUnLFxyXG4gIGNvbG9yOiAnIzAwNzREOScsXHJcbiAga2VlcFNlbGVjdGVkSW5MaXN0OiB0cnVlLFxyXG4gIGNsb3NlT25TZWxlY3Q6IGZhbHNlLFxyXG4gIGNsZWFyT25CbHVyOiB0cnVlLFxyXG4gIGNsZWFyT25TZWxlY3Q6IHRydWUsXHJcbiAgZHJvcGRvd25Qb3NpdGlvbjogJ2JvdHRvbScsXHJcbiAgZHJvcGRvd25IZWlnaHQ6ICczMDBweCcsXHJcbiAgYXV0b0ZvY3VzOiBmYWxzZSxcclxuICBwb3J0YWw6IG51bGwsXHJcbiAgY3JlYXRlOiBmYWxzZSxcclxuICBkaXJlY3Rpb246ICdsdHInLFxyXG4gIG5hbWU6IG51bGwsXHJcbiAgcmVxdWlyZWQ6IGZhbHNlLFxyXG4gIHBhdHRlcm46IGZhbHNlLFxyXG4gIG9uQ2hhbmdlOiAoKSA9PiB1bmRlZmluZWQsXHJcbiAgb25Ecm9wZG93bk9wZW46ICgpID0+IHVuZGVmaW5lZCxcclxuICBvbkRyb3Bkb3duQ2xvc2U6ICgpID0+IHVuZGVmaW5lZCxcclxuICBvbkNsZWFyQWxsOiAoKSA9PiB1bmRlZmluZWQsXHJcbiAgb25TZWxlY3RBbGw6ICgpID0+IHVuZGVmaW5lZCxcclxuICBvbkNyZWF0ZU5ldzogKCkgPT4gdW5kZWZpbmVkLFxyXG4gIHNlYXJjaEZuOiAoKSA9PiB1bmRlZmluZWQsXHJcbiAgaGFuZGxlS2V5RG93bkZuOiAoKSA9PiB1bmRlZmluZWQsXHJcbiAgYWRkaXRpb25hbFByb3BzOiBudWxsLFxyXG4gIGJhY2tzcGFjZURlbGV0ZTogdHJ1ZVxyXG59O1xyXG5cclxuY29uc3QgUmVhY3REcm9wZG93blNlbGVjdCA9IHN0eWxlZC5kaXZgXHJcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAgYm9yZGVyOiAxcHggc29saWQgI2NjYztcclxuICB3aWR0aDogMTAwJTtcclxuICBib3JkZXItcmFkaXVzOiAycHg7XHJcbiAgcGFkZGluZzogMnB4IDVweDtcclxuICBmbGV4LWRpcmVjdGlvbjogcm93O1xyXG4gIGRpcmVjdGlvbjogJHsoeyBkaXJlY3Rpb24gfSkgPT4gZGlyZWN0aW9ufTtcclxuICBhbGlnbi1pdGVtczogY2VudGVyO1xyXG4gIGN1cnNvcjogcG9pbnRlcjtcclxuICBtaW4taGVpZ2h0OiAzNnB4O1xyXG4gICR7KHsgZGlzYWJsZWQgfSkgPT5cclxuICAgIGRpc2FibGVkID8gJ2N1cnNvcjogbm90LWFsbG93ZWQ7cG9pbnRlci1ldmVudHM6IG5vbmU7b3BhY2l0eTogMC4zOycgOiAncG9pbnRlci1ldmVudHM6IGFsbDsnfVxyXG5cclxuICA6aG92ZXIsXHJcbiAgOmZvY3VzLXdpdGhpbiB7XHJcbiAgICBib3JkZXItY29sb3I6ICR7KHsgY29sb3IgfSkgPT4gY29sb3J9O1xyXG4gIH1cclxuXHJcbiAgOmZvY3VzLFxyXG4gIDpmb2N1cy13aXRoaW4ge1xyXG4gICAgb3V0bGluZTogMDtcclxuICAgIGJveC1zaGFkb3c6IDAgMCAwIDNweCAkeyh7IGNvbG9yIH0pID0+IGhleFRvUkdCQShjb2xvciwgMC4yKX07XHJcbiAgfVxyXG5gO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgU2VsZWN0O1xyXG4iXX0= */")),_default=Select;exports.default=_default;